---
title: "Анализ рельефа"
format: html
---

# Исходные данные

В качестве исходных данных мы воспользуемся слоем с границами двух природных заповедников: *Кавказского государственного природного биосферного заповедника* и *Приэльбрусье*.

Слой с их границами вы можете скачать по ссылке: <https://disk.yandex.ru/d/tcUoFxV-mqNang>

Вторым источником данных в нашем случае станет **цифровая модель рельефа** FABDEM.

Нужные вам для работы фрагменты цифровой модели рельефа вы можете скачать по ссылке <https://disk.yandex.ru/d/Q6K-Ly-kT6jiNg>

# Цифровая модель рельефа

Цифровая модель рельефа (ЦМР) — это растровое представление непрерывной поверхности, обычно относящееся к поверхности Земли[^1].

[^1]: Что такое цифровые модели рельефа (ЦМР) - <https://pro.arcgis.com/ru/pro-app/latest/tool-reference/spatial-analyst/exploring-digital-elevation-models.htm>

::: callout-important
Различают цифровую модель рельефа и цифровую модель местности. Разница между ними состоит в том, что цифровая модель местности включает в себя все объекты, расположенные на поверхности, тогда как цифровая модель рельефа - это только поверхность земли без растительности и строений.

![Источник: https://innoter.com/articles/matritsa-vysot/](images/matrix_height_04.webp){fig-align="center"}
:::

Цифровые модели рельефа, как правило, строят либо по результатам интерполяции, либо на основе открытых данных.

Самым распространенным источником данных о рельефе является цифровая модель рельефа SRTM (shuttle radar topographic mission). Эта цифровая модель была получена в 2000 году на основе спутниковой радарной съемки. Она охватывает планету между 54 градусами южной широты и 60 градусами северной широты. Подробнее на русском можно почитать про нее [здесь](https://gis-lab.info/qa/srtm.html)

Скачать данные SRTM можно на сайте Геологической службы США (<https://earthexplorer.usgs.gov/>) или с помощью плагина [SRTM downloader](https://plugins.qgis.org/plugins/SRTM-Downloader/)[^2].

[^2]: **Плагин SRTM-Downloader — загрузка SRTM с сервера прямо в QGIS** <https://cartetika.ru/tpost/98m7ngx971-plagin-srtm-downloader-zagruzka-srtm-s-s>

::: callout-warning
Для использования модуля и загрузки данных напрямую из QGIS все равно необходимы реквизиты аккаунта на сайте USGS.
:::

::: callout-warning
Значительным недостатком SRTM является ее ограниченный пространственный охват: от 54 градусов южной широты до 60 градусов северной широты, из-за которого значительная часть нашей страны не покрыта этой цифровой моделью рельефа.
:::

Из SRTM выгружается сразу целая 1-градусная трапеция (фрагмент 1 градус по широте и 1 градус по долготе), в этом случае трапеция была обрезана до более маленького фрагмента (вообще не очень рекомендую работать с большими растрами, охватывающими сразу градус и более по долготе и широте).

::: callout-note
Более современной и точной цифровой моделью рельефа является модель FABDEM, к тому же она действительно глобальная и охватывает всю территорию земного шара.

Немного почитать о ней на русском можно по [ссылке](https://cartetika.ru/tpost/0l2nfnr1l1-tsifrovaya-model-relefa-fabdem).

Самое главное ее отличие от более ранних моделей в наличии процессинга и удалении из нее объектов, расположенных на поверхности Земли.

![Источник: https://iopscience.iop.org/article/10.1088/1748-9326/ac4d4f](images/erlac4d4ff1_hr.jpg){fig-align="center"}

Сама модель является открытой и данные можно скачать по ссылке из репозитория - <https://data.bris.ac.uk/data/dataset/s5hqmjcdj8yo2ibzi9b4ew3sn>

Все данные организованы в архивы, которые включают в себя охват 10 широты на 10 градусов долготы. Растровые данные внутри архивов - это одноградусные трапеции.

Для того, чтобы понять, какой именно архив и файл из него нужен вам на исследуемую территорию, можно скачать файл ***FABDEM_v1-2_tiles.geojson*** и открыть его либо в QGIS, либо с использованием сервиса geojson.io. Прямоугольники в этом файле показывают одноградусные трапеции, а в их атрибутах указано название архива и файла.

![](images/Снимок%20экрана%202025-03-13%20в%2016.21.33.png){fig-align="center"}
:::

::: callout-note
Более современная и точная модель рельефа, основанная на ансамблевом расчете обобщенной модели с использованием распространенных открытых цифровых моделей рельефа - Global Ensemble Digital Terrain Model 30m (GEDTM30) (<https://zenodo.org/records/14900181)> глобальная цифровая модель рельефа (DTM) в виде двух GeoTIFF файлов оптимизированных для облачной работы (cloud GeoTIFF) общим объёмом чуть менее 39 гигабайт.

![](images/photo_2025-04-28_12-23-16.jpg){fig-align="center"}
:::

::: callout-tip
Еще одна современная недавно вышедшая цифровая модель рельефа FathomDEM: Uhe, P. et al. (2025). **FathomDEM**: an improved global terrain map using a hybrid vision transformer model. Environmental Research Letters, 20(3), 034002. <https://doi.org/10.1088/1748-9326/ada972>

Данные предоставляются бесплатно по запросу Америка (<https://doi.org/10.5281/zenodo.14511570),> Евразия и Африка (<https://doi.org/10.5281/zenodo.14523356)>.

Видео инструкция по работе с данными в QGIS <https://www.youtube.com/watch?v=KWwg4EmJMkk>
:::

# Скачивание цифровой модели рельефа

Все данные организованы в архивы, которые включают в себя охват 10 широты на 10 градусов долготы. Растровые данные внутри архивов - это одноградусные трапеции.

Для того, чтобы понять, какой именно архив и файл из него нужен вам на исследуемую территорию, можно скачать файл ***FABDEM_v1-2_tiles.geojson*** и открыть его либо в QGIS, либо с использованием сервиса geojson.io. Прямоугольники в этом файле показывают одноградусные трапеции, а в их атрибутах указано название архива и файла.

Воспользуемся QGIS для поиска нужных названий нужных нам архивов и файлов.

В первую очередь откроем файл ***заповедники.geojson***, который вы должны скачать по ссылке выше.

![](images/clipboard-1315701442.png){fig-align="center" width="1610"}

Далее здесь же откроем файл ***FABDEM_v1-2_tiles.geojson.***

![](images/clipboard-1682643172.png){fig-align="center" width="1501"}

Каждый прямоугольник в этом файле определяет одноградусную трапецию.

Чтобы посмотреть в атрибутах этих объектов названия нужных вам архивов и файлов, вы можете просто выделить интересующие вас прямоугольники на карте, а потом открыть таблицу атрибутов и посмотреть в нее.

![](images/clipboard-715894770.png){fig-align="center" width="1536"}

В атриубтивной таблице вы видите три поля/атрибута:

-   *tile_name* - имя отдельной трапеции;

-   *file_name* - название файла;

-   *zipfile_name* - название архива, в котором этот файл размещен.

Второй вариант - это воспользоваться инструментом *Определить объекты* ![](images/clipboard-3204396934.png){width="53"}.

После клика на объект с использованием этого инструмента вы увидите панель, в которой показаны атрибуты объекта, на который вы кликнули.

![](images/clipboard-2051923143.png){fig-align="center" width="1070"}

Для создания нашей карты нам нужно скачать два архива:

-   N40E040-N50E050_FABDEM_V1-2

-   N40E030-N50E040_FABDEM_V1-2

После скачивания архивы необходимо распаковать, чтобы вы могли работать с содержащимися в них растрами.

После того, как вы определились с нужными вам архивами и файлами, слой с названиями тайлов можно убрать, он вам больше не будет нужен.

::: callout-tip
В том случае, если у вас плохо открывается слой в программе, вы можете воспользоваться сервисом geojson.io и открыть файл в нем, чтобы определить нужные вам архивы и файлы.

![](images/clipboard-4089906260.png){fig-align="center" width="1528"}
:::

# Загрузка ЦМР в QGIS

В каждой ячейке исходного растрового изображения содержится значение высоты.

Добавление растрового слоя осуществляется через строку меню *Слой* $\longrightarrow$ *Добавить слой* $\longrightarrow$ *Добавить растровый слой*.

![](images/191.png)

После открытия файла его лучше сразу перепроецировать на лету в EPSG:3857.

::: callout-tip
Перепроецирование на лету не будет изменять систему координат слоя, а только изменит систему координат проекта и то, как ваша карта будет отображаться на экране.

Перепроецирование на лету может быть выполнено с использованием кнопки в правом нижнем углу основного окна программы.
:::

# Карта теневого рельефа

**Отмывка рельефа** (также теневой рельеф, shaded relief) – это метод представления рельефа, при котором кажется, что на элементы рельефа сбоку падает свет[^3].

[^3]: **Отмывка рельефа в QGIS – покажем рельеф эстетично!** <https://cartetika.ru/tpost/6eul4ld921-otmivka-relefa-v-qgis-pokazhem-relef-est>

Для создания карты теневого рельефа воспользуемся одноградусной трапецией, которая попадает на территорию Приэльбрусья.

Откроем нужный нам растр с использованием строки меню: *Слой* $\longrightarrow$ *Добавить слой* $\longrightarrow$ *Добавить растровый слой*.

![](images/clipboard-1156954442.png){fig-align="center"}

Добавленная цифровая модель рельефа будет показана в оттенках серого цвета. Темные цвета соотвествуют маленьким значениям высоты, светлые - большим.

![](images/clipboard-1298605427.png)

## Обрезка растра

Обрежем наш исходный растр с цифровой моделью по границам заповедника.

Для этого воспользуемся строкой меню *Растр* $\longrightarrow$ *Извлечение* $\longrightarrow$ *Обрезать растр по маске*.

![](images/clipboard-2438088375.png){fig-align="center"}

В качестве маски у нас будет выступать векторный слой с границами заповедников.

Здесь обязательно необходимо указать, какой растр будет обрезаться и что будет использоваться в качестве маски, остальные параметры опциональны.

![](images/clipboard-2772134938.png){fig-align="center" width="955"}

В результате мы получим растр, обрезанный по границам полигона.

![](images/clipboard-1096286518.png){fig-align="center" width="912"}

## Теневой рельеф как стиль растрового слоя

Теневой рельеф может быть задан как вариант стиля для растрового слоя.

![](images/clipboard-2875140980.png){fig-align="center" width="1534"}

Параметры высота и азимут задают положение источника света.

::: callout-important
В данном случае одним из самых важных параметров является **Масштабирование по Z -** этот параметр позволяет соотнести между собой единицы измерения плановых координат и высот. В нашем случае высоты в ячейках растра приведены в метрах, а координаты - в градусах., кроме того, стоит учитывать, что в географических системах координат искажение зависит от долготы.

С этим можно справиться двумя способами - перепроецировать растра в прямоугольную систему координат или задать масштабирование по Z (Z-factor). Фактически с помощью этого коэффициента мы переходим от градусов к метрам. Так как у нас окрестности Эльбруса, то можно воспользоваться значением коэффициента для 40 градусов долготы - 0.00001171[^4]

|        |                  |
|--------|------------------|
| Широта | Z factor (метры) |
| 0      | 0.00000898       |
| 10     | 0.00000912       |
| 20     | 0.00000956       |
| 30     | 0.00001036       |
| 40     | 0.00001171       |
| 50     | 0.00001395       |
| 60     | 0.00001792       |
| 70     | 0.00002619       |
| 80     | 0.00005156       |
:::

[^4]: **Setting the Z Factor parameter correctly** <https://www.esri.com/arcgis-blog/products/product/imagery/setting-the-z-factor-parameter-correctly>

В результате применения этого стиля вы увидите, что ваш рельеф стал выглядеть объемным.

![](images/clipboard-1430589557.png)

::: callout-tip
Можете попробовать поэкспериментировать с азимутом и высотой источника света.
:::

Этот теневой рельеф можно использовать, чтобы добавить дополнительный объем подложке (предварительно нужно добавить) или исходному рельефу растра. Для этого нужно открыть свойства слоя с теневым рельефом и изменить режим смешивания на Добавление, Осветление или Затемнение (также можно поэкспериментировать с настройками яркости и контрастности).

![](images/clipboard-4218799371.png){fig-align="center" width="1292"}

Кроме того вы можете настроить разнонаправленные источники света для того, чтобы сделать рельеф еще более выразительным.

![](images/clipboard-2302416757.png)

::: callout-caution
В случае использования теневого рельефа как стиля растрового слоя и в отсутствие перепроецирования вы увидите на карте некоторые артефакты - "рябь" на картинке.
:::

## Расчет теневого рельефа

Более стабильной опцией без артефактов будет расчет теневого рельефа как отдельного слоя.

Для этого воспользуемся инструментом из панели инструментов анализа *Теневой рельеф*.

![](images/clipboard-3132614352.png){fig-align="center" width="565"}

Здесь необходимо указать исходный растр для расчета, коэффициент масштабирования по Z, о котором говорилось выше, и местоположение источника света.

![](images/clipboard-1469836738.png)

В результате вы получите новый слой, который далее можно настраивать так, как вы посчитаете нужным.

![](images/clipboard-1622199236.png)

Например, можно воспользоваться режимом смешивания и комбинировать его с подложкой.

![](images/clipboard-2969664077.png){fig-align="center" width="1242"}

## Расчет теневого рельефа с использованием модуля Terrain shading

Для еще большей выразительности рельефа можно воспользоваться модулем [*Terrain shading*](https://plugins.qgis.org/plugins/TerrainShading/).

Чуть подробнее про его функции можно почитать в [блоге разработчика](https://landscapearchaeology.org/qgis-terrain-shading/).

![](images/clipboard-3710304682.png){fig-align="center" width="989"}

Этот модуль после установки должен появиться у вас в панели инструментов анализа.

![](images/clipboard-2214567668.png){fig-align="center" width="638"}

Модуль содержит сразу три функции, которые позволяют строить теневую отмывку:

-   *Hillshade (terrain shading)* - аналогичен стандартному построению теневого рельефа;
-   *Shadow depth* - инструмент для генерации теней;
-   *Toposhade* - комбинация теневого рельефа и индекса топографического положения, который показывает выпуклость и вогнутость рельефа. Такая комбинация позволяет добиться более выраженной карты теневого рельефа;
-   *Texture shading* - добавление текстуры.

Добавим отбрасываемые тени к нашему рельефу.

![](images/clipboard-1650847616.png){fig-align="center" width="1356"}

В качестве параметров здесь нам необходимо указать исходный растр и местоположение источника света (азимут и угол падения лучей).

::: callout-warning
Данный модуль рекомендует использование плоской прямоугольной системы координат с метрическими единицами измерения. Так достигается одинаковый размер ячеек растра.

Наш растр в географической системе, поэтому вы увидите предупреждение об этом, но расчет будет выполнен.

![](images/clipboard-2308638003.png){fig-align="center" width="1213"}
:::

Полученный растр с тенями будет добавлен в проект.

![](images/clipboard-240764213.png){fig-align="center" width="704"}

Его вы можете использовать в комбинации с другими растрами и подложками, чтобы получить выразительный рельеф на карте.

![Комбинация теневого рельефа, теней (режим смешивания умножение и затемнение соответственно) и подложки 2ГИС](images/clipboard-1752594719.png){fig-align="center" width="724"}

Рассчитаем и добавим на карту текстуру.

![](images/clipboard-2229174116.png){fig-align="center" width="1361"}

Результат создания текстуры с подложкой показан на рисунке ниже.

![](images/clipboard-1436906196.png){fig-align="center" width="766"}

Сочетание с теневым рельефом и тенями дает достаточно драматичный эффект.

![](images/clipboard-4218192180.png){fig-align="center" width="729"}

Воспользуемся инструментом, который по мнению разработчика модуля дает лучший результат, чем просто теневой рельеф - *Toposhade*.

![](images/clipboard-3080904326.png){fig-align="center" width="1220"}

::: callout-note
Этот инструмент комбинирует расчет теневого рельеф и так называемого индекса топографического положения.

Формы рельефа определяются на основе *индекса топографического положения (Topographic position index - TPI)*. Этот индекс позволяет классифицировать формы рельефа по высоте конкретного пикселя относительно соседей: если он ниже, то значение индекса будет отрицательным и он будет отнесен к вогнутой форме рельефа; если он выше соседей, то индекс будет больше нуля и этот пиксель будет классифицирован как выпуклая часть рельефа.

![Источник: https://landscapearchaeology.org/2019/tpi/](images/clipboard-1982547815.png){fig-align="center"}

![Источник: https://chuck-sutherland.blogspot.com/2019/10/topographic-position-index-tpi-as.html](images/clipboard-3819645520.png){fig-align="center"}
:::

![](images/clipboard-901916336.png){fig-align="center" width="626"}

## Добавление эффекта тумана[^5]

[^5]: **Карта рельефа с эффектом тумана в QGIS** <https://cartetika.ru/tpost/ncjlhkl2u1-karta-relefa-s-effektom-tumana-v-qgis>

Для того, чтобы имитировать туман, сделаем полупрозрачную заливку только небольших высот на карте.

В качестве исходной карты рельефа будет взята карта с текстурным рельефом, тенями и теневым рельефом.

![](images/clipboard-2310117738.png){fig-align="center" width="607"}

В первую очередь нужно продублировать исходный слой с цифровой моделью рельефа (можно сразу его переименовать для того, чтобы не запутаться).

В настройках стиля этого продублированного растра выберем опцию *Одноканальное псевдоцветное*. После чего нужно выбрать градиент (здесь подойдет любой градиент, так как мы все равно его будет редактировать).

После выбора градиента нужно открыть его редактирование (просто кликнув на полосу градиента в настройках). В градиенте необходимо оставить только начальную и конечную опорные точки, удалив все промежуточные.

Для удаления промежуточных опорных точек в градиенте нужно кликнуть на флажок под изображением градиента (это выделит нужную опорную точку), а потом нажать на клавиатуре клавишу *Delete*.

Для начальной точки вы можете выбрать свой цвет и установить его прозрачность на 75%, а для конечной точки нужно просто установить белый цвет с прозрачностью в 100 %.

::: callout-tip
Так как мы пытаемся добиться эффекта тумана лучше использовать серые или серо-голубые оттенки.
:::

![](images/clipboard-4119951700.png){fig-align="center" width="1096"}

После применения свойств стиля ваша карта будет покрыта дымкой.

![](images/clipboard-3429452332.png){fig-align="center" width="684"}

Чтобы сделать туман только в низине, можно добавить дополнительную опорную точку.

![](images/clipboard-1136395354.png)

Это позволит уменьшить разброс заливки по высотам цифровой модели рельефа.

![](images/clipboard-1617715753.png){fig-align="center" width="676"}

# Карта рельефа с горизонталями

Карту рельефа с горизонталями мы построим для территории второго рассматриваемого заповедника *Кавказского государственного природного биосферного заповедника.*

## Склеивание растров

Как видно из картинки территория заповедника попадает на несколько одноградусных трапеций сразу. Для того, чтобы нам было проще с ними работать дальше сначала мы склеим их в единый растр, а потом обрежем по границам заповедника аналогично предыдущей карте.

![](images/clipboard-1968570118.png)

Откроем все нужные нам растры.

![](images/clipboard-1300439599.png)

Для объединения нескольких растров в один воспользуемся инструментом слияния растров: *Растр* $\longrightarrow$ *Прочее* $\longrightarrow$ *Создать виртуальный растр*.

![](images/clipboard-2554289341.png){fig-align="center"}

::: callout-caution
Особенность виртуального растра состоит в том, что он не создает привычный файл в растровом формате, а скорее собирает уже существующие растры вместе. Отчасти это похоже на проект в QGIS, в котором тоже сохраняются связи между файлами слоев.
:::

В открывшемся окне необходимо выбрать нужные нам растры и указать место для сохранения. В нашем случае - это промежуточный этап, поэтому сохранять не обязательно.

![](images/clipboard-2085008369.png)

Итоговый растр будет отображаться единым слоем на карте и в панели слоев.

![](images/clipboard-2197704745.png){fig-align="center" width="1223"}

Обрежем растр аналогично предыдущему разделу.

![](images/clipboard-528967062.png)

Итогом будет обрезанное по границам заповедника цифровая модель рельефа.

![](images/clipboard-4037397016.png)

## Построение горизонталей и их стилизация

Для создания горизонталей воспользуемся инструментом из строки меню *Растр* $\longrightarrow$ *Извлечение* $\longrightarrow$ *Создать изолинии*.

![](images/clipboard-1437411027.png){fig-align="center" width="981"}

Исходным слоем выступает цифровая модель рельефа. Основной параметр - расстояние между изолиниями, то есть интервал высот между изолиниями.

Желательно подбирать этот интервал так, чтобы изолинии не были слишком часто или слишком редко.

![](images/clipboard-2326419011.png){fig-align="center" width="1216"}

После окончания расчетов вы получите новый векторный слой с линейными объектами - изолиниями.

Основным атрибутом их будет указанный на предыдущем этапе атрибут высоты (у меня оставлен по умолчанию *ELEV*).

![](images/clipboard-3977489277.png){fig-align="center" width="1101"}

Как правило, на топографических картах утолщается каждая пятая горизонталь. В нашем случае это будут горизонтали со значением кратным 1000.

Зададим толщину линий на основе выражения.

![](images/clipboard-4071298137.png){fig-align="center" width="1787"}

Нужное нам выражение условия:

```         
if ("ELEV"%1000=0,1,0.3)
```

Это стандартное условие *если*. В скобках указывается само условие, потом, что необходимо сделать, если условие выполнено, и что, если не выполнено.

В нашем случае условием является целочисленное деление на 1000 без остатка: то есть, если высота горизонтали кратна 1000. При выполнении условия толщина будет 1 единица, при невыполнении 0,3.

![](images/clipboard-535140055.png){fig-align="center" width="1424"}

После применения условия на карте часть изолиний будет утолщена, а часть останется тонкой.

![](images/clipboard-3734812653.png)

## Настройка подписей горизонталей

По принятым правилам составления топографических карт:

-   подписывать нужно только утолщенные горизонтали;

-   горизонталь должна прерываться для размещения подписи;

-   подписи должны размещаться "головой" в сторону увеличения высоты.

Создадим подпись на основе правила, в качестве которого используем целочисленное деление, которое уже фигурировало выше в условии для утолщения линий.

```         
"ELEV"%1000=0
```

![](images/clipboard-4182106674.png){fig-align="center" width="1192"}

Текстом для подписи будет выступать атрибут *ELEV*.

Так как для подписей горизонтали должны прерываться, но мы воспользуемся уже знакомой нам опцией буфера для текста.

Чтобы подписи были размещены прямо на линии, необходимо в настройке *Размещение* выбрать режим "Вдоль кривых" и установить разрешенные позиции "На линии".

![](images/clipboard-1824517056.png){fig-align="center" width="1181"}

На карте вы увидите подписи только нужных вам горизонталей.

![](images/clipboard-739170510.png)

Для настройки ориентации подписей воспользуемся генератором геометрии в настройках размещения:

```         
reverse($geometry)
```

![](images/clipboard-1413592720.png){fig-align="center" width="1177"}

Еще необходимо разрешить перевернутые подписи.

![](images/clipboard-3400859431.png){fig-align="center" width="1182"}

Полученные горизонтали с подписями соответствуют тому, как они должны размещаться на топографических картах.

![](images/clipboard-2570239643.png)

# Построение профиля местности

При построении профиля местности рельеф рассекается вертикальной плоскостью и путем соединения точек пересечения этой плоскости и рельефа строится профиль.

![](images/clipboard-1915956449.png){fig-align="center" width="556"}

Для построения профиля существует специальный инструмент *Профиль высот*, который можно найти в строке меню в пункте *Вид*.

![](images/clipboard-3467328661.png){fig-align="center" width="781"}

Панель для построения профиля откроется у вас в нижней части окна. В нее должны автоматически добавиться все ваши цифровые модели рельефа.

![](images/clipboard-1172654901.png)

::: callout-tip
Если нужная вам цифровая модель рельефа не появилась на панели, то вам нужно в свойствах растрового слоя указать, что он представляет высотные данные.

![](images/clipboard-1571563602.png)
:::

На панели построения профиля есть некоторые инструменты, специфичные только для нее.

![](images/clipboard-328716183.png){fig-align="center" width="1346"}

Сохранить свой профиль вы можете как картинкой, так и экспортироваеть саму линию (в том числе с параметром высоты), а также сохранить таблицу со значениями высот и расстояний.

![](images/clipboard-1552758214.png){fig-align="center" width="615"}

::: callout-tip
При необходимости вы можете добавить высотный профиль на макет карты при ее оформлении.

Он добавляется как любой элемент макета с вертикальной панели слева ![](images/clipboard-1364603157.png){width="52"}.

Для того, чтобы в добавленном элементе был отображен высотный профиль, вы можете просто скопировать его из основного окна проекта.

![](images/clipboard-3388951722.png){fig-align="center" width="783"}
:::

# Построение трехмерной поверхности

Также QGIS поддреживает отображение трехмерных поверхностей. Для этого нужно просто в строке меню выбрать **Вид - Новая 3D карта**.

![](images/215.png)

После чего в окне программы появится окно трехмерной карты (перемещение по карте левой кнопкой мыши, поворот и наклон - колесико, приближение - правая кнопка мыши).

![](images/216.PNG)

Сразу после открытия нового окна поверхность все еще является плоской, потому что не задано на основе чего строить трехмерную поверхность.

В окне трехмерной карты нужно нажать кнопку **Настройки** (в панели значков крайняя справа) и в открывшемся окне настроек выбрать тип **DEM (raster layer)**, **высота** (растровый слой с высотами) и **вертикальный масштаб** (здесь лучше всзять что-то от 1 до 5, чтобы поверхность была повыразительнее).

Дополнительно можно добавить **Terrain shading** (фактически теневая отмывка) и подкорректировать **tile resolution** (чем больше, тем более подробным будет рельеф), и **skirt height** (если правильно нашла - высота подставки под саму поверхность).

![](images/217.PNG)

После чего в окне будет отображена трехмерная поверхность.

![](images/218.PNG)

# Расчет параметров рельефа

![](images/clipboard-1366913423.png){fig-align="center"}

::: callout-important
Уклон поверхности – это угол наклона в точке пересечения между горизонтальной плоскостью и плоскостью касательной к земной поверхности; фиксирует интенсивность перепада высот (градиент) между двумя заданными точками.
:::

::: callout-important
*Экспозиция поверхности – угол по часовой стрелке между определенным направлением (как правило, на север) и проекцией уклона на горизонтальную плоскость; фиксирует направление (азимут) максимального уклона (градиента) земной поверхности*[^6].
:::

[^6]: Основные геоморфометрические параметры: теория - [https://gis-lab.info/qa/geomorphometric-parameters-theory.html#%D0%9E%D1%81%D0%BD%D0%BE%D0%B2%D0%BD%D1%8B%D0%B5\_%D0%B3%D0%B5%D0%BE%D0%BC%D0%BE%D1%80%D1%84%D0%BE%D0%BC%D0%B5%D1%82%D1%80%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B5\_%D0%BF%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80%D1%8B](https://gis-lab.info/qa/geomorphometric-parameters-theory.html#%D0%9E%D1%81%D0%BD%D0%BE%D0%B2%D0%BD%D1%8B%D0%B5_%D0%B3%D0%B5%D0%BE%D0%BC%D0%BE%D1%80%D1%84%D0%BE%D0%BC%D0%B5%D1%82%D1%80%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B5_%D0%BF%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80%D1%8B,){.uri}

![Определение основных геоморфометрических параметров по Zevenbergen, Thorne (1987). Источник: https://gis-lab.info/qa/geomorphometric-parameters-theory.html](images/800px-Geomorpho_theory_03.png){fig-align="center"}

Расчет осуществляется по принципу «движущегося окна», где в центре находится целевая ячейка, для которой осуществляется расчет – z~5~, а значения смежных ячеек используются для вычислений.

Уклон или крутизна склона рассчитывается по формуле:

$$
\alpha = arctan(\sqrt{G^2+H^2})
$$

где $G=\dfrac{z_6-z_4}{2l}$ - уклон по направлению восток-запад;

$H=\dfrac{z_2-z_8}{2l}$ - уклон по направлению север-юг;

$l$ - размер ячейки растра.

Экспозиция склона рассчитывается по формуле;

$$
\beta=180^{\circ}-arctan (\dfrac{\pm H}{\pm G}) + 90 ^{\circ}(\dfrac{\pm G}{|G|})
$$

## Расчет крутизны склонов[^7]

[^7]: Документация функции <https://docs.qgis.org/3.16/en/docs/user_manual/processing_algs/qgis/rasterterrainanalysis.html?highlight=relief%20analysis#slope>

Рассчитаем крутизну склонов - угол наклона каждого склона в градусах.

![](images/207.PNG)

![](images/208.PNG)

### Выделение территорий пригодных для строительства с учетом уклона

Для того, чтобы выделить области пригодные для строительства, воспользуемся переклассификацией растра.

При переклассификации будем рассматривать территории с уклоном менее 10 %.

Так как уклон был рассчитан в градусах, а параметр пригодности для строительства задан в процентах, то пересчитаем этот параметр в градусы по формуле:

$$
Slope_{degree}=arctg(\dfrac{Slope_{percent}}{100})
$$

Полученное значение пригодности - 6 градусов.

Переклассифицируем растр и выделим области пригодные или непригодные для строительства.

![](images/Снимок%20экрана%202025-03-12%20в%2012.12.49.png){fig-align="center"}

::: callout-important
Обратите внимание, что здесь в дополнительных параметрах можно указать, как именно будут задаваться границы интервалов, то есть будут ли включаться в них нижний или верхний предел интервала.

![](images/Снимок%20экрана%202025-03-12%20в%2012.18.05.png){fig-align="center" width="600"}
:::

В таблице реклассификации следует ввести границы интервалов и соответствующее им значение (эти значения должны быть целочисленными.

![](images/Снимок%20экрана%202025-03-12%20в%2012.12.25.png){fig-align="center"}

В результате будет получен дискретный растр с двумя значениями (или с тем количеством значений классов, которое вы указали в таблице реклассификации.

![](images/Снимок%20экрана%202025-03-12%20в%2012.21.50.png){fig-align="center"}

## Экспозиция склонов[^8]

[^8]: Экспозиция - <https://docs.qgis.org/3.16/en/docs/user_manual/processing_algs/qgis/rasterterrainanalysis.html?highlight=relief%20analysis#aspect>

Эта функция позволяет определить ориентацию склонов по сторонам света.

![](images/211.PNG)

![](images/212.PNG)

# Расчет высоты расположения зданий

В том случае, если необходимо рассчитать значение высот в пределах объектов векторного слоя (административных районов, например) или значение высот, на которых расположены здания, можно воспользоваться стандартным инструментом *Зональная статистика*.

Этот инструмент позволяет рассчитать значение какой-либо из статистик растрового слоя в пределах векторных объектов.

В качестве исходных данных была использована цифровая модель рельефа FABDEM для территории Москвы и векторный слой со зданиями, скачанными из OSM.

![](images/Снимок%20экрана%202025-03-14%20в%2016.00.10.png){fig-align="center"}

![](images/Снимок%20экрана%202025-03-14%20в%2015.58.21.png){fig-align="center"}

Доступные для расчета статистические показатели приведены на рисунке ниже. Вы можете использовать один из них или любой набор из нескольких.

![](images/clipboard-1231871418.png)

По результатам расчета вы получите векторный слой с объектами из исходного слоя, но в их атрибутивную таблицу будет добавлено новое поле с полученными значениями показателя (или несколько полей, если вы рассчитывали несколько показателей).

![](images/clipboard-4005033751.png)

# Построение зон видимости

Анализ видимости здесь рассмотрен на основе модуля [*Visibility analysis*](https://landscapearchaeology.org/qgis-visibility-analysis/).

## Индекс видимости[^9]

[^9]: **Visibility index (total viewshed) for QGIS : finally there! -** <https://landscapearchaeology.org/2020/visibility-index/>

**Индекс видимости** - это метрика, показывающая поле зрения для любой точки ланшафта.

Индекс видимости рассчитывается как отношение положительных визуальных связей: 1,0 или 100% означает, что точка видна со всех своих соседей.

В качестве исходных данных здесь задается только цифровая модель рельефа, остальные параметры устанавливаются непосредственно при расчете:

-   радиус анализа - насколько далеко необходимо осуществлять видимость;

-   высота наблюдателя, то есть высота, с которой осуществляется обзор относительно поверхности земли;

-   sample - количество линий обзора;

-   направление - расчет с точки зрения наблюдения за ландшафтом или как точек обзора.

![](images/clipboard-4226039794.png)

![Индекс видимости](images/clipboard-1249412332.png){fig-align="center" width="1505"}

## Расчет бассейнов видимости[^10]

[^10]: **Viewshed analysis in QGIS 3: a tutorial -** <https://landscapearchaeology.org/2020/viewshed-tutorial/>

Результатом расчета бассейна видимости, как правило, является бинарный растр со значениями 1 (пиксель видим с точки обзора) или 0 (пиксель не виден с точки обзора).

Если точек обзора много, то их бассейны видимости будут суммироваться при наложении.

На первом этапе необходимо создать точки обзора из имеющегося точечного слоя - *Create viewpoints*.

![](images/Снимок%20экрана%202025-03-14%20в%2015.20.26.png){fig-align="center"}

В качестве исходных данных в расчет передаются точечный слой, для которого будут осуществляться расчеты, и цифровая модель рельефа.

::: callout-important
Важно, что слой с точками обзора и цифровая модель рельефа должны быть в одной системе координат.
:::

Обязательными параметрами являются:

-   радиус анализа (в метрах) - максимальное расстояние видимости;

-   высота наблюдателя, то есть высота, с которой ведется обзор (здесь может быть задана как высота среднего роста человека, так и высота здания, если обзор будет осуществляться с него);

-   целевая высота - значение высоты, которое добавляется ко всем участкам местности, проверяемым на видимость из точки наблюдателя.

В результате вы получите точечный слой из объектов, которые могут использоваться как точки обзора, так как имеют свою собственную высоту.

Далее можно рассчитать бассейны видимости с помощью инструмента *Viewshed*.

![](images/Снимок%20экрана%202025-03-14%20в%2015.26.55.png){fig-align="center"}

Инструмент позволяет рассчитать три вида бассейнов видимости:

-   бинарный - видно/не видно (1/0);

-   расположение ниже горизонта - высота, на которую должно подняться каждое место, чтобы стать видимым;

-   горизонт - внешний край бассейна видимости.

![](images/Снимок%20экрана%202025-03-14%20в%2015.26.19.png){fig-align="center"}

При использовании двух точек обзора были получены зоны видимости, показанные на рисунке ниже.

![](images/Снимок%20экрана%202025-03-14%20в%2015.30.39.png){fig-align="center"}

Для отображения зон видимости поверх остального рельефа можно настроить стиль полученного слоя как *Палитра/Уникальные значения* и сделать нулевые значения прозрачными.

![](images/Снимок%20экрана%202025-03-14%20в%2015.32.54.png){fig-align="center"}

В результате на карте у вас будут отображаться только те зоны, которые видны с ваших точек обзора, поверх остальных слоев.

![](images/Снимок%20экрана%202025-03-14%20в%2015.34.42.png){fig-align="center"}

:::: callout-tip
В том случае, если у вас есть цифровая модель поверхности со всеми зданиями для исследуемой территории, можно воспользоваться модулем *Visibility analysis* и вот этим [туториалом](https://medium.com/data-science/running-visibility-analysis-in-qgis-d8fbdd8b02c5).

![](images/1_L7P9M0puu8v0sUIaO_foGg.webp){fig-align="center"}

![](images/1_0xSmzCifZ3KmiErSgmIieQ.webp){fig-align="center"}

::: callout-tip
Для добавления зданий к цифровой модели рельефа можно использовать модуль [UMEP](https://umep-docs.readthedocs.io/projects/tutorial/en/latest/Tutorials/DSMGenerator.html).
:::
::::

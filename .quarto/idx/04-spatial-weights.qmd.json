{"title":"Пространственные веса","markdown":{"yaml":{"title":"Пространственные веса","format":"html"},"headingText":"Программа GeoDa","containsRefs":false,"markdown":"\n\n\n**GeoDa** - это бесплатный программный инструмент с открытым исходным кодом, который служит для ознакомления с пространственной наукой о данных. Он разработан для того, чтобы способствовать получению новых выводов на основе анализа данных путем изучения и моделирования пространственных моделей.\n\n![](images/esda.png){fig-align=\"center\"}\n\nСайт программы: <https://geodacenter.github.io/> (на нем же можно скачать файл установки программы).\n\n::: callout-tip\nОзнакомиться с документацией можно по [ссылке](https://geodacenter.github.io/documentation.html).\n\n```{=html}\n<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/--8vhhmpgdM?si=l5NZLgepg2xaVY4C\" title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen>\n\n</iframe>\n```\n:::\n\nОсновной интерфейс программы состоит из панели инструментов и строки меню.\n\n![Результаты анализа, карты и атрибутивные таблицы будут открываться в отдельных окнах.](images/Снимок%20экрана%202025-03-26%20в%2012.28.44.png){fig-align=\"center\"}\n\nGeoDa поддерживает основные векторные форматы пространственных данных, а также подключение к базам данных и использование векторных данных с веб-ресурсов в формате *.geojson* и *WFS*.\n\nПри запуске программы у вас появится окно открытия источника данных.\n\n![](images/Снимок%20экрана%202025-03-26%20в%2012.44.31.png){fig-align=\"center\"}\n\nВ том случае, если это окно не открылось, необходимый вам файл можно открыть по клику на значок ![](images/Снимок%20экрана%202025-03-26%20в%2014.49.38.png){width=\"37\"}.\n\n# Исходные данные\n\nВ качестве исходных данных будет использоваться набор данных о стоимости недвижимости в Санкт-Петербурге, который можно скачать по [ссылке](https://disk.yandex.ru/d/2pZazAW_vuxTuA).\n\n::: callout-caution\nОтноситесь к этим данным как к синтетическим, так как их источник ненадежен.\n:::\n\n# Общие инструменты работы с данными\n\nПосле того, как вы открыли файл с исходными данными, у вас появится окно карты.\n\n![](images/Снимок%20экрана%202025-03-26%20в%2014.50.30.png)\n\nВ этой карте как и в прочих геоинформационных системах вы можете добавить подложку для контекста с использованием иконки ![](images/Снимок%20экрана%202025-03-26%20в%2014.50.52.png){width=\"48\"}.\n\n![](images/Снимок%20экрана%202025-03-26%20в%2014.51.01.png){fig-align=\"center\"}\n\n::: callout-tip\nКроме открытия слоя с имеющейся геометрией программа имеет функции по созданию геометрии точечного слоя из таблицы или создания сетки, а также пространственного объединения слоев (*Spatial join*) и слияния объектов (*Dissolve*).\n\n![](images/Снимок%20экрана%202025-03-26%20в%2014.56.19.png){fig-align=\"center\"}\n\nПространственное объединение позволяет объединять объекты из разных слоев, а слияние - объекты одного слоя по значению атрибута (например, мы могли бы так объединить муниципальные образования в районы).\n:::\n\nНастройка карты для визуализации показателя может быть осуществлена двумя способами:\n\n-   через строку меню;\n\n![](images/Снимок%20экрана%202025-04-02%20в%2014.07.03.png){fig-align=\"center\"}\n\n-   правым кликом на карте\n\n![](images/Снимок%20экрана%202025-03-26%20в%2014.51.42.png){fig-align=\"center\"}\n\nНастройка здесь может быть осуществлена на основе стилей/тем по умолчанию, либо создана в виде кастомных интервалов.\n\n![](images/Снимок%20экрана%202025-03-26%20в%2014.52.46.png){fig-align=\"center\"}\n\n::: callout-tip\nНа самом деле любой стиль по умолчанию можно подредактировать при необходимости и получить свой собственный стиль. Для этого нужно просто открыть редактор категорий ![](images/Снимок%20экрана%202025-03-26%20в%2014.57.37.png){width=\"36\"}.\n\n![](images/Снимок%20экрана%202025-03-26%20в%2014.53.31.png){fig-align=\"center\"}\n:::\n\n::: callout-tip\nПри необходимости сохранения интервалов, вы можете это сделать, просто кликнув правой кнопкой мыши и выбрав *Save rates*. Тогда номера интервалов будут сохранены в атрибутивную таблицу.\n\n![](images/Снимок%20экрана%202025-04-02%20в%2014.12.32.png){fig-align=\"center\"}\n:::\n\n::: callout-note\nКроме обычной фоновой картограммы, также есть опция создания картограммы Дорлинга ![](images/Снимок%20экрана%202025-03-26%20в%2014.57.22.png), в которой все объекты будут заменены на круги различного диаметра в зависимости от значения показателя.\n\nПричем отдельно здесь можно указать, что будет обозначать цвет символа, а что - его размер.\n\n![](images/Снимок%20экрана%202025-04-02%20в%2014.32.37.png){fig-align=\"center\"}\n\nПолученная картограмма также может быть отдельно донастроена по цветовой палитре.\n\n![](images/Снимок%20экрана%202025-04-02%20в%2014.33.38.png){fig-align=\"center\"}\n:::\n\nАтрибутивную таблицу можно открыть в отдельном окне по клику на иконку ![](images/Снимок%20экрана%202025-03-26%20в%2014.54.48.png){width=\"40\"}.\n\n![](images/Снимок%20экрана%202025-03-26%20в%2014.54.59.png){fig-align=\"center\"}\n\nВ строке меню есть отдельный пункт *Table*, который содержит в себе инструменты для работы с таблицами.\n\n![](images/Снимок%20экрана%202025-03-26%20в%2014.55.12.png){fig-align=\"center\"}\n\nПри необходимости вы можете добавлять или удалять атрибуты, а также редактировать типы данных в столбцах, если они были определены при открытии неправильно.\n\n![](images/Снимок%20экрана%202025-03-26%20в%2014.55.35.png){fig-align=\"center\"}\n\nДля атрибутивной таблицы есть калькулятор полей, позволяющий осуществлять расчеты.\n\n![](images/Снимок%20экрана%202025-03-26%20в%2014.55.53.png){fig-align=\"center\"}\n\n::: callout-note\nТакже в программе есть довольно большой выбор инструментов для исследовательского анализа данных, представленных в основной панели инструментов.\n\n![](images/Снимок%20экрана%202025-04-02%20в%2012.56.43.png){fig-align=\"center\"}\n:::\n\n# Расчет пространственных весов\n\nДля создания матрицы пространственных весов необходимо воспользоваться менеджером весов ![](images/Снимок%20экрана%202025-04-02%20в%2015.03.14.png){width=\"44\"}, также его можно открыть из строки меню.\n\n![](images/Снимок%20экрана%202025-04-02%20в%2015.03.27.png){fig-align=\"center\"}\n\nВ открывшемся окне менеджера весов вы увидите опции для создания новых и загрузки уже рассчитанных матриц пространственных весов.\n\n![](images/Снимок%20экрана%202025-04-02%20в%2015.04.12.png){fig-align=\"center\"}\n\nПосле начала создания матрицы пространственных весов вы увидите окно, в котором можно выбрать тип рассчитаваемого веса.\n\n![](images/Снимок%20экрана%202025-04-02%20в%2015.07.36.png){fig-align=\"center\"}\n\n::: callout-important\nОчень важно, чтобы при создании матрицы весов у каждого объекта в наборе данных был уникальный идентификатор - порядковый номер, если такого идентификатора нет, то его можно просто создать *Add ID variable*.\n\n![](images/Снимок%20экрана%202025-04-02%20в%2015.09.00.png){fig-align=\"center\"}\n:::\n\n::: callout-note\nВсе матрицы весов сохраняются во внутреннем формате программы: два разных формата - один для матриц по смежности, второй - для матриц на основе расстояния. При необходимости они могут быть открыты просто в текстовом редакторе.\n:::\n\n## Расчет весов по смежности\n\n### Принцип ферзя (королевы)\n\n::: callout-important\nДля того, чтобы объекты считались соседями, достаточно, чтобы у них была хотя бы одна общая точка.\n:::\n\nПри создании весов по смежности достаточно выбрать используемый принцип смежности и порядок (мы везде по умолчанию используем только первый порядок соседства).\n\n![](images/Снимок%20экрана%202025-04-02%20в%2015.13.07.png){fig-align=\"center\"}\n\nПараметр *Precision threshold* (порог точности) здесь нужен в том счучае, если вы сомневаетесь в качестве своих исходных данных и корректном примыкании пространственных объектов друг к другу, так как позволяет задать размер потенциального зазора или наложения.\n\nПосле создания вам будет предложено сохранить матрицу весов в специализированном формате. Полученная матрица появится в менеджере весов.\n\n![](images/Снимок%20экрана%202025-04-02%20в%2015.13.14.png){fig-align=\"center\"}\n\nВ менеджере весов вы можете ознакомиться с параметрами каждой матрицы:\n\n-   ее тип;\n\n-   симметричность;\n\n-   название файла, в котором она сохранена;\n\n-   атрибут с порядковым номером;\n\n-   порядок соседства (для матриц по смежности);\n\n-   количество наблюдений;\n\n-   минимальное и максимальное число соседей внутри набора данных;\n\n-   среднее и медианное число соседей;\n\n-   процент ненулевых элементов матрицы.\n\nКроме того, вы можете изучить матрицу весов визуально с помощью гистограммы, карты или графа связности.\n\nНа гистограмме высота столбцов показывает количество объектов, имеющее определенное число соседей, которое показано по оси X.\n\n![](images/Снимок%20экрана%202025-04-02%20в%2015.17.55.png){fig-align=\"center\"}\n\n::: callout-tip\nПри выделении любого из столбиков вы сможете увидеть на карте, про какие именно объекты идет речь.\n\n![](images/Снимок%20экрана%202025-04-02%20в%2015.20.50.png){fig-align=\"center\"}\n:::\n\nКарта связности показывает выделенный объект, на который наведен курсор (зеленым цветом) и его соседей в соответствии с матрицей весов.\n\n![](images/Снимок%20экрана%202025-04-02%20в%2015.22.05.png){fig-align=\"center\"}\n\nГраф связности же отображает топологические связи между объектами соседями.\n\n![](images/Снимок%20экрана%202025-04-02%20в%2015.23.12.png){fig-align=\"center\"}\n\nПри выделении одного из объектов на графе будут отображаться только его соседи.\n\n![](images/Снимок%20экрана%202025-04-02%20в%2015.24.00.png){fig-align=\"center\"}\n\n::: callout-note\nЕсли вы откроете матрицу пространственных весов в текстовом редакторе вы увидите только ее ненулевые элементы.\n\n![](images/Снимок%20экрана%202025-04-02%20в%2015.30.47.png){fig-align=\"center\"}\n:::\n\n### Принцип ладьи\n\n::: callout-important\nДля того, чтобы объекты считались соседями, между ними должна быть общая ненулевая граница (то есть общей точки здесь недостаточно).\n:::\n\nПостроение матрицы весов по принципу ладьи происходит аналогично предыдущему пункту.\n\n![](images/Снимок%20экрана%202025-04-02%20в%2015.25.31.png){fig-align=\"center\"}\n\nИ после создания эта матрица также будет отображена в менеджере весов.\n\n![](images/Снимок%20экрана%202025-04-02%20в%2015.26.10.png){fig-align=\"center\"}\n\nАналогично матрице весов по принципу ферзя/королевы вы можете более подробно изучить структуру матрицы с помощью графиков:\n\n-   гистограмма;\n\n![](images/Снимок%20экрана%202025-04-02%20в%2015.28.07.png){fig-align=\"center\"}\n\n-   карта связности;\n\n![](images/Снимок%20экрана%202025-04-02%20в%2015.28.38.png){fig-align=\"center\"}\n\n::: callout-note\nОбратите внимание, что в нижней панели окна карты связности отображается номер объекта, на котором расположен курсор и номера его соседей.\n:::\n\n-   граф связности.\n\n![](images/Снимок%20экрана%202025-04-02%20в%2015.29.32.png){fig-align=\"center\"}\n\n::: callout-important\nОбратите внимание, что при использовании принципа ладьи вы получаете в среднем меньше соседей для каждого из объектов.\n:::\n\n::: callout-note\nТакже вы можете попробовать определить соседей по смежности, используя QGIS.\n\n```{=html}\n<iframe width=\"600\" height=\"400\" src=\"https://www.youtube.com/embed/c7lXotTM7vk?si=rDHN0VWZFlhMI_bh\" title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen></iframe>\n```\n\nЕще один вариант расчета ближайших соседей с использованием скрипта python для QGIS рассмотрен по [ссылке](https://gis.stackexchange.com/questions/227431/qgis-neighborhood-analysis).\n:::\n\n::: callout-note\nМатрицы весов по смежности всегда будут симметричными относительно главной диагонали, что с точки зрения соседства значит, что объект $i$ будет соседом объекту $j$ и наоборот.\n:::\n\n## Расчет весов по расстоянию\n\nПри расчете весов по расстоянию необходимо задать значительно больше параметров.\n\n![](images/Снимок%20экрана%202025-04-02%20в%2015.34.59.png){fig-align=\"center\"}\n\nВ первую очередь следует указать, как и между чем будет рассчитываеться расстояние.\n\nПо умолчанию для полигональных объектов предлагается использовать центроиды по координатам, но эти же центроиды могут рассчитываться по значениям любого числового показателя. Кроме того для расчета расстояния не обязательно вообще использовать центроиды или пространственное положение объектов, вы можете воспользоваться любыми числовыми показателями вашей атрибутивной таблицы.\n\n![](images/Снимок%20экрана%202025-04-02%20в%2015.37.45.png){fig-align=\"center\"}\n\nРасстояние может быть рассчитано двумя способами:\n\n-   евклидово расстояние на плоскости;\n\n-   расстояние на эллипсоиде (в милях или метрах).\n\nДалее следует выбрать метод расчета весов по расстоянию и его параметры:\n\n-   *distance band* (гибридные веса) - объекты будут считаться соседями, если расстояние между ними не превышает заданного. Здесь в качестве параметра необходимо задать это расстояние, по умолчанию устанавливается такая величина расстояния, которая гарантирует всем объектам как минимум одного соседа (максимальное расстояние между ближайшими объектами).\n\n::: callout-important\nОбратите внимание, что здесь вы можете использовать обратное расстояние (*Inverse distance*), то есть в результате в матрице весов будет исвользоваться не само расстояние, а $\\dfrac{1}{distance^{power}}$.\n:::\n\n-   *k-ближайших соседей*, где необходимо задать необходимое число соседей;\n\n-   *ядерные веса*, для которых вы можете выбрать:\n\n    -   тип функции;\n\n    -   необходимость применения ее только в пределах определенного расстояния (*specify bandwidth*);\n\n    -   адаптивное расстояние, которое должно включать в себя определенное заданное число соседей;\n\n    -   возможность использовать максимальное расстояние для заданного числа соседей как ширину полосы пропускания.\n\n![](images/Снимок%20экрана%202025-04-02%20в%2015.44.04.png){fig-align=\"center\"}\n\nВ текстовом виде матрицы весов будут выглядеть иначе:\n\n![Матрица весов по расстоянию (гибридные веса)](images/Снимок%20экрана%202025-04-07%20в%2011.40.38.png){fig-align=\"center\"}\n\n![Матрица ядерных весов](images/Снимок%20экрана%202025-04-07%20в%2011.40.49.png){fig-align=\"center\"}\n\nЗдесь уже не будут просто перечислены ненулевые элементы, то есть список соседей для каждого объекта, а расстояние для каждой пары соседей: в случае гибридных весов и $k$-ближайших соседей - расстояние (то, которое было рассчитано), а в случае ядерных весов - значение ядерной функции от расстояния.\n\n![](images/Снимок%20экрана%202025-04-07%20в%2011.46.03.png){fig-align=\"center\"}\n\n::: callout-note\nПопробуйте построить различные матрицы весов для разных параметров и сравнить их между собой.\n:::\n\n::: callout-note\nМатрицы весов по расстоянию уже не будут симметричными, то есть объект $i$ может быть соседом объекту $j$, в то время как объект $j$ не будет являться соседом объекту $i$.\n:::\n","srcMarkdownNoYaml":"\n\n# Программа GeoDa\n\n**GeoDa** - это бесплатный программный инструмент с открытым исходным кодом, который служит для ознакомления с пространственной наукой о данных. Он разработан для того, чтобы способствовать получению новых выводов на основе анализа данных путем изучения и моделирования пространственных моделей.\n\n![](images/esda.png){fig-align=\"center\"}\n\nСайт программы: <https://geodacenter.github.io/> (на нем же можно скачать файл установки программы).\n\n::: callout-tip\nОзнакомиться с документацией можно по [ссылке](https://geodacenter.github.io/documentation.html).\n\n```{=html}\n<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/--8vhhmpgdM?si=l5NZLgepg2xaVY4C\" title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen>\n\n</iframe>\n```\n:::\n\nОсновной интерфейс программы состоит из панели инструментов и строки меню.\n\n![Результаты анализа, карты и атрибутивные таблицы будут открываться в отдельных окнах.](images/Снимок%20экрана%202025-03-26%20в%2012.28.44.png){fig-align=\"center\"}\n\nGeoDa поддерживает основные векторные форматы пространственных данных, а также подключение к базам данных и использование векторных данных с веб-ресурсов в формате *.geojson* и *WFS*.\n\nПри запуске программы у вас появится окно открытия источника данных.\n\n![](images/Снимок%20экрана%202025-03-26%20в%2012.44.31.png){fig-align=\"center\"}\n\nВ том случае, если это окно не открылось, необходимый вам файл можно открыть по клику на значок ![](images/Снимок%20экрана%202025-03-26%20в%2014.49.38.png){width=\"37\"}.\n\n# Исходные данные\n\nВ качестве исходных данных будет использоваться набор данных о стоимости недвижимости в Санкт-Петербурге, который можно скачать по [ссылке](https://disk.yandex.ru/d/2pZazAW_vuxTuA).\n\n::: callout-caution\nОтноситесь к этим данным как к синтетическим, так как их источник ненадежен.\n:::\n\n# Общие инструменты работы с данными\n\nПосле того, как вы открыли файл с исходными данными, у вас появится окно карты.\n\n![](images/Снимок%20экрана%202025-03-26%20в%2014.50.30.png)\n\nВ этой карте как и в прочих геоинформационных системах вы можете добавить подложку для контекста с использованием иконки ![](images/Снимок%20экрана%202025-03-26%20в%2014.50.52.png){width=\"48\"}.\n\n![](images/Снимок%20экрана%202025-03-26%20в%2014.51.01.png){fig-align=\"center\"}\n\n::: callout-tip\nКроме открытия слоя с имеющейся геометрией программа имеет функции по созданию геометрии точечного слоя из таблицы или создания сетки, а также пространственного объединения слоев (*Spatial join*) и слияния объектов (*Dissolve*).\n\n![](images/Снимок%20экрана%202025-03-26%20в%2014.56.19.png){fig-align=\"center\"}\n\nПространственное объединение позволяет объединять объекты из разных слоев, а слияние - объекты одного слоя по значению атрибута (например, мы могли бы так объединить муниципальные образования в районы).\n:::\n\nНастройка карты для визуализации показателя может быть осуществлена двумя способами:\n\n-   через строку меню;\n\n![](images/Снимок%20экрана%202025-04-02%20в%2014.07.03.png){fig-align=\"center\"}\n\n-   правым кликом на карте\n\n![](images/Снимок%20экрана%202025-03-26%20в%2014.51.42.png){fig-align=\"center\"}\n\nНастройка здесь может быть осуществлена на основе стилей/тем по умолчанию, либо создана в виде кастомных интервалов.\n\n![](images/Снимок%20экрана%202025-03-26%20в%2014.52.46.png){fig-align=\"center\"}\n\n::: callout-tip\nНа самом деле любой стиль по умолчанию можно подредактировать при необходимости и получить свой собственный стиль. Для этого нужно просто открыть редактор категорий ![](images/Снимок%20экрана%202025-03-26%20в%2014.57.37.png){width=\"36\"}.\n\n![](images/Снимок%20экрана%202025-03-26%20в%2014.53.31.png){fig-align=\"center\"}\n:::\n\n::: callout-tip\nПри необходимости сохранения интервалов, вы можете это сделать, просто кликнув правой кнопкой мыши и выбрав *Save rates*. Тогда номера интервалов будут сохранены в атрибутивную таблицу.\n\n![](images/Снимок%20экрана%202025-04-02%20в%2014.12.32.png){fig-align=\"center\"}\n:::\n\n::: callout-note\nКроме обычной фоновой картограммы, также есть опция создания картограммы Дорлинга ![](images/Снимок%20экрана%202025-03-26%20в%2014.57.22.png), в которой все объекты будут заменены на круги различного диаметра в зависимости от значения показателя.\n\nПричем отдельно здесь можно указать, что будет обозначать цвет символа, а что - его размер.\n\n![](images/Снимок%20экрана%202025-04-02%20в%2014.32.37.png){fig-align=\"center\"}\n\nПолученная картограмма также может быть отдельно донастроена по цветовой палитре.\n\n![](images/Снимок%20экрана%202025-04-02%20в%2014.33.38.png){fig-align=\"center\"}\n:::\n\nАтрибутивную таблицу можно открыть в отдельном окне по клику на иконку ![](images/Снимок%20экрана%202025-03-26%20в%2014.54.48.png){width=\"40\"}.\n\n![](images/Снимок%20экрана%202025-03-26%20в%2014.54.59.png){fig-align=\"center\"}\n\nВ строке меню есть отдельный пункт *Table*, который содержит в себе инструменты для работы с таблицами.\n\n![](images/Снимок%20экрана%202025-03-26%20в%2014.55.12.png){fig-align=\"center\"}\n\nПри необходимости вы можете добавлять или удалять атрибуты, а также редактировать типы данных в столбцах, если они были определены при открытии неправильно.\n\n![](images/Снимок%20экрана%202025-03-26%20в%2014.55.35.png){fig-align=\"center\"}\n\nДля атрибутивной таблицы есть калькулятор полей, позволяющий осуществлять расчеты.\n\n![](images/Снимок%20экрана%202025-03-26%20в%2014.55.53.png){fig-align=\"center\"}\n\n::: callout-note\nТакже в программе есть довольно большой выбор инструментов для исследовательского анализа данных, представленных в основной панели инструментов.\n\n![](images/Снимок%20экрана%202025-04-02%20в%2012.56.43.png){fig-align=\"center\"}\n:::\n\n# Расчет пространственных весов\n\nДля создания матрицы пространственных весов необходимо воспользоваться менеджером весов ![](images/Снимок%20экрана%202025-04-02%20в%2015.03.14.png){width=\"44\"}, также его можно открыть из строки меню.\n\n![](images/Снимок%20экрана%202025-04-02%20в%2015.03.27.png){fig-align=\"center\"}\n\nВ открывшемся окне менеджера весов вы увидите опции для создания новых и загрузки уже рассчитанных матриц пространственных весов.\n\n![](images/Снимок%20экрана%202025-04-02%20в%2015.04.12.png){fig-align=\"center\"}\n\nПосле начала создания матрицы пространственных весов вы увидите окно, в котором можно выбрать тип рассчитаваемого веса.\n\n![](images/Снимок%20экрана%202025-04-02%20в%2015.07.36.png){fig-align=\"center\"}\n\n::: callout-important\nОчень важно, чтобы при создании матрицы весов у каждого объекта в наборе данных был уникальный идентификатор - порядковый номер, если такого идентификатора нет, то его можно просто создать *Add ID variable*.\n\n![](images/Снимок%20экрана%202025-04-02%20в%2015.09.00.png){fig-align=\"center\"}\n:::\n\n::: callout-note\nВсе матрицы весов сохраняются во внутреннем формате программы: два разных формата - один для матриц по смежности, второй - для матриц на основе расстояния. При необходимости они могут быть открыты просто в текстовом редакторе.\n:::\n\n## Расчет весов по смежности\n\n### Принцип ферзя (королевы)\n\n::: callout-important\nДля того, чтобы объекты считались соседями, достаточно, чтобы у них была хотя бы одна общая точка.\n:::\n\nПри создании весов по смежности достаточно выбрать используемый принцип смежности и порядок (мы везде по умолчанию используем только первый порядок соседства).\n\n![](images/Снимок%20экрана%202025-04-02%20в%2015.13.07.png){fig-align=\"center\"}\n\nПараметр *Precision threshold* (порог точности) здесь нужен в том счучае, если вы сомневаетесь в качестве своих исходных данных и корректном примыкании пространственных объектов друг к другу, так как позволяет задать размер потенциального зазора или наложения.\n\nПосле создания вам будет предложено сохранить матрицу весов в специализированном формате. Полученная матрица появится в менеджере весов.\n\n![](images/Снимок%20экрана%202025-04-02%20в%2015.13.14.png){fig-align=\"center\"}\n\nВ менеджере весов вы можете ознакомиться с параметрами каждой матрицы:\n\n-   ее тип;\n\n-   симметричность;\n\n-   название файла, в котором она сохранена;\n\n-   атрибут с порядковым номером;\n\n-   порядок соседства (для матриц по смежности);\n\n-   количество наблюдений;\n\n-   минимальное и максимальное число соседей внутри набора данных;\n\n-   среднее и медианное число соседей;\n\n-   процент ненулевых элементов матрицы.\n\nКроме того, вы можете изучить матрицу весов визуально с помощью гистограммы, карты или графа связности.\n\nНа гистограмме высота столбцов показывает количество объектов, имеющее определенное число соседей, которое показано по оси X.\n\n![](images/Снимок%20экрана%202025-04-02%20в%2015.17.55.png){fig-align=\"center\"}\n\n::: callout-tip\nПри выделении любого из столбиков вы сможете увидеть на карте, про какие именно объекты идет речь.\n\n![](images/Снимок%20экрана%202025-04-02%20в%2015.20.50.png){fig-align=\"center\"}\n:::\n\nКарта связности показывает выделенный объект, на который наведен курсор (зеленым цветом) и его соседей в соответствии с матрицей весов.\n\n![](images/Снимок%20экрана%202025-04-02%20в%2015.22.05.png){fig-align=\"center\"}\n\nГраф связности же отображает топологические связи между объектами соседями.\n\n![](images/Снимок%20экрана%202025-04-02%20в%2015.23.12.png){fig-align=\"center\"}\n\nПри выделении одного из объектов на графе будут отображаться только его соседи.\n\n![](images/Снимок%20экрана%202025-04-02%20в%2015.24.00.png){fig-align=\"center\"}\n\n::: callout-note\nЕсли вы откроете матрицу пространственных весов в текстовом редакторе вы увидите только ее ненулевые элементы.\n\n![](images/Снимок%20экрана%202025-04-02%20в%2015.30.47.png){fig-align=\"center\"}\n:::\n\n### Принцип ладьи\n\n::: callout-important\nДля того, чтобы объекты считались соседями, между ними должна быть общая ненулевая граница (то есть общей точки здесь недостаточно).\n:::\n\nПостроение матрицы весов по принципу ладьи происходит аналогично предыдущему пункту.\n\n![](images/Снимок%20экрана%202025-04-02%20в%2015.25.31.png){fig-align=\"center\"}\n\nИ после создания эта матрица также будет отображена в менеджере весов.\n\n![](images/Снимок%20экрана%202025-04-02%20в%2015.26.10.png){fig-align=\"center\"}\n\nАналогично матрице весов по принципу ферзя/королевы вы можете более подробно изучить структуру матрицы с помощью графиков:\n\n-   гистограмма;\n\n![](images/Снимок%20экрана%202025-04-02%20в%2015.28.07.png){fig-align=\"center\"}\n\n-   карта связности;\n\n![](images/Снимок%20экрана%202025-04-02%20в%2015.28.38.png){fig-align=\"center\"}\n\n::: callout-note\nОбратите внимание, что в нижней панели окна карты связности отображается номер объекта, на котором расположен курсор и номера его соседей.\n:::\n\n-   граф связности.\n\n![](images/Снимок%20экрана%202025-04-02%20в%2015.29.32.png){fig-align=\"center\"}\n\n::: callout-important\nОбратите внимание, что при использовании принципа ладьи вы получаете в среднем меньше соседей для каждого из объектов.\n:::\n\n::: callout-note\nТакже вы можете попробовать определить соседей по смежности, используя QGIS.\n\n```{=html}\n<iframe width=\"600\" height=\"400\" src=\"https://www.youtube.com/embed/c7lXotTM7vk?si=rDHN0VWZFlhMI_bh\" title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerpolicy=\"strict-origin-when-cross-origin\" allowfullscreen></iframe>\n```\n\nЕще один вариант расчета ближайших соседей с использованием скрипта python для QGIS рассмотрен по [ссылке](https://gis.stackexchange.com/questions/227431/qgis-neighborhood-analysis).\n:::\n\n::: callout-note\nМатрицы весов по смежности всегда будут симметричными относительно главной диагонали, что с точки зрения соседства значит, что объект $i$ будет соседом объекту $j$ и наоборот.\n:::\n\n## Расчет весов по расстоянию\n\nПри расчете весов по расстоянию необходимо задать значительно больше параметров.\n\n![](images/Снимок%20экрана%202025-04-02%20в%2015.34.59.png){fig-align=\"center\"}\n\nВ первую очередь следует указать, как и между чем будет рассчитываеться расстояние.\n\nПо умолчанию для полигональных объектов предлагается использовать центроиды по координатам, но эти же центроиды могут рассчитываться по значениям любого числового показателя. Кроме того для расчета расстояния не обязательно вообще использовать центроиды или пространственное положение объектов, вы можете воспользоваться любыми числовыми показателями вашей атрибутивной таблицы.\n\n![](images/Снимок%20экрана%202025-04-02%20в%2015.37.45.png){fig-align=\"center\"}\n\nРасстояние может быть рассчитано двумя способами:\n\n-   евклидово расстояние на плоскости;\n\n-   расстояние на эллипсоиде (в милях или метрах).\n\nДалее следует выбрать метод расчета весов по расстоянию и его параметры:\n\n-   *distance band* (гибридные веса) - объекты будут считаться соседями, если расстояние между ними не превышает заданного. Здесь в качестве параметра необходимо задать это расстояние, по умолчанию устанавливается такая величина расстояния, которая гарантирует всем объектам как минимум одного соседа (максимальное расстояние между ближайшими объектами).\n\n::: callout-important\nОбратите внимание, что здесь вы можете использовать обратное расстояние (*Inverse distance*), то есть в результате в матрице весов будет исвользоваться не само расстояние, а $\\dfrac{1}{distance^{power}}$.\n:::\n\n-   *k-ближайших соседей*, где необходимо задать необходимое число соседей;\n\n-   *ядерные веса*, для которых вы можете выбрать:\n\n    -   тип функции;\n\n    -   необходимость применения ее только в пределах определенного расстояния (*specify bandwidth*);\n\n    -   адаптивное расстояние, которое должно включать в себя определенное заданное число соседей;\n\n    -   возможность использовать максимальное расстояние для заданного числа соседей как ширину полосы пропускания.\n\n![](images/Снимок%20экрана%202025-04-02%20в%2015.44.04.png){fig-align=\"center\"}\n\nВ текстовом виде матрицы весов будут выглядеть иначе:\n\n![Матрица весов по расстоянию (гибридные веса)](images/Снимок%20экрана%202025-04-07%20в%2011.40.38.png){fig-align=\"center\"}\n\n![Матрица ядерных весов](images/Снимок%20экрана%202025-04-07%20в%2011.40.49.png){fig-align=\"center\"}\n\nЗдесь уже не будут просто перечислены ненулевые элементы, то есть список соседей для каждого объекта, а расстояние для каждой пары соседей: в случае гибридных весов и $k$-ближайших соседей - расстояние (то, которое было рассчитано), а в случае ядерных весов - значение ядерной функции от расстояния.\n\n![](images/Снимок%20экрана%202025-04-07%20в%2011.46.03.png){fig-align=\"center\"}\n\n::: callout-note\nПопробуйте построить различные матрицы весов для разных параметров и сравнить их между собой.\n:::\n\n::: callout-note\nМатрицы весов по расстоянию уже не будут симметричными, то есть объект $i$ может быть соседом объекту $j$, в то время как объект $j$ не будет являться соседом объекту $i$.\n:::\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"markdown"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":true,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"toc":true,"number-sections":true,"shift-heading-level-by":1,"output-file":"04-spatial-weights.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.5.57","editor":"visual","theme":"flatly","number-depth":3,"anchor-sections":true,"title":"Пространственные веса"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}
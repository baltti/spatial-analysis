---
title: "Анализ рельефа"
format: html
---

# Цифровая модель рельефа

Цифровая модель рельефа (ЦМР) — это растровое представление непрерывной поверхности, обычно относящееся к поверхности Земли[^1].

[^1]: Что такое цифровые модели рельефа (ЦМР) - <https://pro.arcgis.com/ru/pro-app/latest/tool-reference/spatial-analyst/exploring-digital-elevation-models.htm>

::: callout-important
Различают цифровую модель рельефа и цифровую модель местности. Разница между ними состоит в том, что цифровая модель местности включает в себя все объекты, расположенные на поверхности, тогда как цифровая модель рельефа - это только поверхность земли без растительности и строений.

![Источник: https://innoter.com/articles/matritsa-vysot/](images/matrix_height_04.webp){fig-align="center"}
:::

Цифровые модели рельефа, как правило, строят либо по результатам интерполяции, либо на основе открытых данных.

Самым распространенным источником данных о рельефе является цифровая модель рельефа SRTM (shuttle radar topographic mission). Эта цифровая модель была получена в 2000 году на основе спутниковой радарной съемки. Она охватывает планету между 54 градусами южной широты и 60 градусами северной широты. Подробнее на русском можно почитать про нее [здесь](https://gis-lab.info/qa/srtm.html)

Скачать данные SRTM можно на сайте Геологической службы США (<https://earthexplorer.usgs.gov/>) или с помощью плагина [SRTM downloader](https://plugins.qgis.org/plugins/SRTM-Downloader/)[^2].

[^2]: **Плагин SRTM-Downloader — загрузка SRTM с сервера прямо в QGIS** <https://cartetika.ru/tpost/98m7ngx971-plagin-srtm-downloader-zagruzka-srtm-s-s>

::: callout-warning
Для использования модуля и загрузки данных напрямую из QGIS все равно необходимы реквизиты аккаунта на сайте USGS.
:::

::: callout-warning
Значительным недостатком SRTM является ее ограниченный пространственный охват, из-за которого значительная часть нашей страны не покрыта этой цифровой моделью рельефа.
:::

Для примера и выполнения работы были скачаны данные для окрестностей Эльбруса (файл [dem_elbrus.tiff](https://drive.google.com/file/d/1FYFUxG7s_T-bEZV4Azu-G7FVfVIDZ86_/view?usp=sharing)).

Из SRTM выгружается сразу целая 1-градусная трапеция (фрагмент 1 градус по широте и 1 градус по долготе), в этом случае трапеция была обрезана до более маленького фрагмента (вообще не очень рекомендую работать с большими растрами, охватывающими сразу градус и более по долготе и широте).

::: callout-note
Более современной и точной цифровой моделью рельефа является модель FABDEM, к тому же она действительно глобальная и охватывает всю территорию земного шара.

Немного почитать о ней на русском можно по [ссылке](https://cartetika.ru/tpost/0l2nfnr1l1-tsifrovaya-model-relefa-fabdem).

Самое главное ее отличие от более ранних моделей в наличии процессинга и удалении из нее объектов, расположенных на поверхности Земли.

![Источник: https://iopscience.iop.org/article/10.1088/1748-9326/ac4d4f](images/erlac4d4ff1_hr.jpg){fig-align="center"}

Сама модель является открытой и данные можно скачать по ссылке из репозитория - <https://data.bris.ac.uk/data/dataset/s5hqmjcdj8yo2ibzi9b4ew3sn>

Все данные организованы в архивы, которые включают в себя охват 10 широты на 10 градусов долготы. Растровые данные внутри архивов - это одноградусные трапеции (как и в SRTM).

Для того, чтобы понять, какой именно архив и файл из него нужен вам на исследуемую территорию, можно скачать файл ***FABDEM_v1-2_tiles.geojson*** и открыть его либо в QGIS, либо с использованием сервиса geojson.io. Прямоугольники в этом файле показывают одноградусные трапеции, а в их атрибутах указано название архива и файла.

![](images/Снимок%20экрана%202025-03-13%20в%2016.21.33.png){fig-align="center"}
:::

В каждой ячейке исходного растрового изображения содержится значение высоты.

Добавление растрового слоя осуществляется через строку меню *Слой* $\longrightarrow$ *Добавить слой* $\longrightarrow$ *Добавить растровый слой*.

![](images/191.png)

После открытия файла его лучше сразу перепроецировать на лету в EPSG:3857.

::: callout-tip
Перепроецирование на лету не будет изменять систему координат слоя, а только изменит систему координат проекта и то, как ваша карта будет отображаться на экране.

Перепроецирование на лету может быть выполнено с использованием кнопки ![](images/Снимок%20экрана%202025-03-03%20в%2017.37.13.png){width="200"} в правом нижнем углу основного окна программы.
:::

В результате будет открыто изображение рельефа в оттенках серого цвета.

![](images/192.PNG)

Это изображение можно сделать цветным, для этого нужно открыть свойства слоя. В настройках стиля нужно выбрать тип изображения **Одноканальное псевдоцветное**.

Одноканальное здесь очевидно потому, что изображение не поделено на каналы и существует только в одном.

![](images/193.PNG)

![](images/194.PNG)

Градиент можно также создать самостоятельно с помощью редактора градиентов.

![](images/195.PNG)

![](images/196.PNG)

Или выбрать из готового каталога градиентов. Для этого при создании нового градиента нужно выбрать каталог **cpt-city**.

![](images/198.PNG)

Далее в каталоге слева выбрать тип градиента Topography и подобрать нужный градиент (можно взять elevation или с3t3).

![](images/199.PNG)

![Градиент c3t3](images/200.PNG)

# Теневой рельеф[^3]

[^3]: <https://docs.qgis.org/3.16/en/docs/user_manual/processing_algs/qgis/rasterterrainanalysis.html?highlight=relief%20analysis#hillshade>

## Расчет теневого рельефа

Для более наглядного отображения рельефа на карте рассчитывается теневой рельеф, который строится с использованием позиции источника направленного света, или теневая отмывка.

![](images/201.PNG)

В данном случае одним из самых важных параметров является **Масштабирование по Z -** этот параметр позволяет соотнести между собой единицы измерения плановых координат и высот. В нашем случае высоты в ячейках растра приведены в метрах, а координаты - в градусах., кроме того, стоит учитывать, что в географических системах координат искажение зависит от долготы.

С этим можно справиться двумя способами - перепроецировать растра в прямоугольную систему координат или задать масштабирование по Z (Z-factor). Фактически с помощью этого коэффициента мы переходим от градусов к метрам. Так как у нас окрестности Эльбруса, то можно воспользоваться значением коэффициента для 40 градусов долготы - 0.00001171.[^4]

[^4]: <https://www.esri.com/arcgis-blog/products/product/imagery/setting-the-z-factor-parameter-correctly/>

Азимут и вертикальный угол задают положение источника света.

![Теневой рельеф (теневая отмывка)](images/202.PNG)

Этот теневой рельеф можно использовать, чтобы добавить дополнительный объем подложке (предварительно нужно добавить) или исходному рельефу растра. Для этого нужно открыть свойства слоя с теневым рельефом и изменить режим смешивания на Добавление, Осветление или Затемнение (также можно поэкспериментировать с настройками яркости и контрастности).

![](images/203.PNG)

![](images/204.PNG)

![](images/205.PNG)

![](images/206.PNG)

::: callout-tip
Также можно воспользоваться функцией Цветной рельеф, которая позволяет создавать классы автоматически и задавать им цвет.

![](images/209.PNG)

![](images/210.PNG)

С использованием такого растра может быть построена трехмерная поверхность, отображающая рельеф местности, а также выполнен ряд вычислений для морфометрического анализа рельефа.

![](images/197.PNG)

Все растровые операции здесь осуществляются за счет разности значений между ячейками.
:::

## Настройка теневого рельефа как стиля растрового слоя

Рассчитывать теневой рельеф и сохранять его в отдельный слой не обязательно, вы можете просто выбрать его как тип стиля для растрового слоя в настройках свойств.

![](images/Снимок%20экрана%202025-03-13%20в%2016.31.31.png){fig-align="center"}

Полученный теневой рельеф после настройки будет отображен на карте.

![](images/Снимок%20экрана%202025-03-13%20в%2016.32.40.png){fig-align="center"}

::: callout-caution
При создании теневого рельефа с использованием настроек стиля растрового слоя на карте могут появляться артефакты - небольшая "рябь" в картинке.

![](images/Снимок%20экрана%202025-03-13%20в%2016.33.35.png){fig-align="center"}
:::

## Использование модуля Terrain shading

Более художественных результатов при создании теневого рельефа позволяет добиться модуль [Terrain shading](https://plugins.qgis.org/plugins/TerrainShading/).

Чуть подробнее про его функции можно почитать в [блоге разработчика](https://landscapearchaeology.org/qgis-terrain-shading/).

Установка модуля осуществляется стандартно (*Модули* $\longrightarrow$ *Управление модулями*). После установки модуль должен появиться у вас в панели Инструменты анализа.

![](images/Снимок%20экрана%202025-03-13%20в%2016.47.37.png){fig-align="center" width="600"}

Модуль содержит сразу три функции, которые позволяют строить теневую отмывку:

-   *Hillshade (terrain shading)* - аналогичен стандартному построению теневого рельефа;

![Результат расчета Hillshade](images/Снимок%20экрана%202025-03-13%20в%2016.52.57.png){fig-align="center"}

-   *Shadow depth* - инструмент для генерации теней;

![Результат расчета Shadow depth](images/Снимок%20экрана%202025-03-13%20в%2016.53.46.png){fig-align="center"}

-   *Toposhade* - комбинация теневого рельефа и индекса топографического положения (о нем будет еще чуть дальше), который показывает выпуклость и вогнутость рельефа. Такая комбинация позволяет добиться более выраженной карты теневого рельефа.

![Результат расчета Toposhade](images/Снимок%20экрана%202025-03-13%20в%2016.54.34.png){fig-align="center"}

::: callout-tip
Полученные новые растры можно комбинировать друг с другом и другими слоями для получения более красивого результата.

![Shadow depth и Hillshade (для обоих установлен режим смешивания Затемнение) в сочетании с подложкой 2GIS](images/Снимок%20экрана%202025-03-13%20в%2016.55.57.png){fig-align="center"}
:::

# Расчет параметров рельефа

## Крутизна склонов[^5]

[^5]: Документация функции <https://docs.qgis.org/3.16/en/docs/user_manual/processing_algs/qgis/rasterterrainanalysis.html?highlight=relief%20analysis#slope>

Расчет крутизны склонов или их уклона и экспозиции осуществляется на основе производных первого порядка.

![Определение основных геоморфометрических параметров по Zevenbergen, Thorne (1987). Источник: https://gis-lab.info/qa/geomorphometric-parameters-theory.html](images/800px-Geomorpho_theory_03.png){fig-align="center"}

### Расчет крутизны склонов

Рассчитаем крутизну склонов - угол наклона каждого склона в градусах.

![](images/207.PNG)

![](images/208.PNG)

### Выделение территорий пригодных для строительства с учетом уклона

Для того, чтобы выделить области пригодные для строительства, воспользуемся переклассификацией растра.

При переклассификации будем рассматривать территории с уклоном менее 10 %.

![](images/photo_2025-02-24_21-18-02.jpg){fig-align="center" width="800"}

Так как уклон был рассчитан в градусах, а параметр пригодности для строительства задан в процентах, то пересчитаем этот параметр в градусы по формуле:

$$
Slope_{degree}=arctg(\dfrac{Slope_{percent}}{100})
$$

Полученное значение пригодности - 6 градусов.

Переклассифицируем растр и выделим области пригодные или непригодные для строительства.

![](images/Снимок%20экрана%202025-03-12%20в%2012.12.49.png){fig-align="center"}

::: callout-important
Обратите внимание, что здесь в дополнительных параметрах можно указать, как именно будут задаваться границы интервалов, то есть будут ли включаться в них нижний или верхний предел интервала.

![](images/Снимок%20экрана%202025-03-12%20в%2012.18.05.png){fig-align="center" width="600"}
:::

В таблице реклассификации следует ввести границы интервалов и соответствующее им значение (эти значения должны быть целочисленными.

![](images/Снимок%20экрана%202025-03-12%20в%2012.12.25.png){fig-align="center"}

В результате будет получен дискретный растр с двумя значениями (или с тем количеством значений классов, которое вы указали в таблице реклассификации.

![](images/Снимок%20экрана%202025-03-12%20в%2012.21.50.png){fig-align="center"}

## Экспозиция склонов[^6]

[^6]: Экспозиция - <https://docs.qgis.org/3.16/en/docs/user_manual/processing_algs/qgis/rasterterrainanalysis.html?highlight=relief%20analysis#aspect>

*Экспозиция поверхности – угол по часовой стрелке между определенным направлением (как правило, на север) и проекцией уклона на горизонтальную плоскость; фиксирует направление (азимут) максимального уклона (градиента) земной поверхности*[^7].

[^7]: Основные геоморфометрические параметры: теория - [https://gis-lab.info/qa/geomorphometric-parameters-theory.html#%D0%9E%D1%81%D0%BD%D0%BE%D0%B2%D0%BD%D1%8B%D0%B5\_%D0%B3%D0%B5%D0%BE%D0%BC%D0%BE%D1%80%D1%84%D0%BE%D0%BC%D0%B5%D1%82%D1%80%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B5\_%D0%BF%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80%D1%8B](https://gis-lab.info/qa/geomorphometric-parameters-theory.html#%D0%9E%D1%81%D0%BD%D0%BE%D0%B2%D0%BD%D1%8B%D0%B5_%D0%B3%D0%B5%D0%BE%D0%BC%D0%BE%D1%80%D1%84%D0%BE%D0%BC%D0%B5%D1%82%D1%80%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B5_%D0%BF%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80%D1%8B,){.uri}

Эта функция позволяет определить ориентацию склонов по сторонам света.

![](images/211.PNG)

![](images/212.PNG)

## Расчет неоднородности рельефа[^8]

[^8]: <https://docs.qgis.org/3.16/en/docs/user_manual/processing_algs/qgis/rasterterrainanalysis.html?highlight=relief%20analysis#ruggedness-index>

Также по растру с данными о рельефе может быть рассчитана неоднородность рельефа.

Этот показатель рассчитывается на основе разности значений между пикселями в сетке 3 на 3. Таким образом, каждый полученный пиксель содержит разницу между центральным пикселем и 8 его окружащими.

![Riley et al (1999) “A Terrain ruggedness Index That Quantifies Topographic heterogeneity”[^9]](images/Снимок%20экрана%202025-03-14%20в%2014.09.56.png){fig-align="center"}

[^9]: <https://download.osgeo.org/qgis/doc/reference-docs/Terrain_Ruggedness_Index.pdf>

[^10]: <https://download.osgeo.org/qgis/doc/reference-docs/Terrain_Ruggedness_Index.pdf>

![](images/213.PNG)

![](images/214.PNG)

# Построение трехмерной поверхности

Также QGIS поддреживает отображение трехмерных поверхностей. Для этого нужно просто в строке меню выбрать **Вид - Новая 3D карта**.

![](images/215.png)

После чего в окне программы появится окно трехмерной карты (перемещение по карте левой кнопкой мыши, поворот и наклон - колесико, приближение - правая кнопка мыши).

![](images/216.PNG)

Сразу после открытия нового окна поверхность все еще является плоской, потому что не задано на основе чего строить трехмерную поверхность.

В окне трехмерной карты нужно нажать кнопку **Настройки** (в панели значков крайняя справа) и в открывшемся окне настроек выбрать тип **DEM (raster layer)**, **высота** (растровый слой с высотами) и **вертикальный масштаб** (здесь лучше всзять что-то от 1 до 5, чтобы поверхность была повыразительнее).

Дополнительно можно добавить **Terrain shading** (фактически теневая отмывка) и подкорректировать **tile resolution** (чем больше, тем более подробным будет рельеф), и **skirt height** (если правильно нашла - высота подставки под саму поверхность).

![](images/217.PNG)

После чего в окне будет отображена трехмерная поверхность.

![](images/218.PNG)

# Создание горизонталей

Из растра со значениями высот могут быть извлечены горизонтали

![](images/219.png)

Расстояние между изолиниями - это фактически высота сечения рельефа, то есть через сколько мы будем проводить горизонтали.

![](images/220.PNG)

Полученные изолинии

![](images/221.PNG)

Настроим горизонтали таким образом, чтобы каждая пятая была утолщенной, добавим подписи и настроим их так, чтобы они были "головой вверх".

Начнем с настройки толщины линий. Для этого в свойствах слоя выберем настройку толщины в зависимости от выражения.

![](images/222.png)

Далее пропишем логическое выражение: **if("ELEV"%500=0,0.7,0.3)**. В этом выражении перед запятой прописано условие - высота горизонтали делится на 500 без остатка, потом толщина линии, если условие выполняется, и толщина, если условие не выполняется.

![](images/223.PNG)

Результат

![](images/224.PNG)

Добавим подписи.

![](images/225.PNG)

Но при таком добавлении подписей, будут подписаны все горизонтали, а мы хотим подписать только утолщенные. Для этого нужно прописать выражение, подобное тому, что мы писали выше: **if("ELEV"%500=0,"ELEV","").**

![](images/226.PNG)

Добавим белую обводку подписям, чтобы они не сливались с горизонталями

![](images/227.PNG)

Сделаем так, чтобы они размещались на линии и изгибались в соответствии с ней.

![](images/228.PNG)

И настроим подписи так, чтобы все они смотрели головой в сторону увеличения высоты.

![](images/229.PNG)

![](images/230.PNG)

В результате получим горизонтали, где каждая пятая будет утолщена и подписана головой в сторону увеличения.

![](images/231.PNG)

# Построение профиля местности

В актуальных версиях программы построения профиля местности по цифровой модели рельефа является функцией по умолчанию. Этот инструмент можно открыть из строки меню *Вид* $\longrightarrow$ *Профиль высот*.

![](images/Снимок%20экрана%202025-03-12%20в%2013.07.28.png){fig-align="center" width="600"}

Окно профиля высот открывается в нижней части интерфейса. Ваша цифровая модель рельефа (если растр с ней загружен в проект должна автоматически добавиться в левую часть окна построения профиля.

![](images/Снимок%20экрана%202025-03-12%20в%2014.14.16.png){fig-align="center"}

::: callout-important
Если ваша цифровая модель рельефа не добавилась в высотный профиль автоматически, то вам нужно проверить ее настройки.

В свойствах слоя (открываются двойным кликом или кликом правой кнопки мыши и выбором пункта *Свойства* из открывшегося контекстного меню) необходимо найти пункт *Высота* и поставить галочку напротив настройки *"Представляет собой данные высоты"*.

![](images/Снимок%20экрана%202025-03-12%20в%2014.16.24.png){fig-align="center"}

После этого ваша цифровая модель будет автоматически добавлена в окно высотного профиля.
:::

Построение профиля может происходить двумя способами:

-   *Захват кривой* ![](images/Снимок%20экрана%202025-03-12%20в%2014.19.51.png){width="35" height="32"} - отрисовка линии профиля осуществляется вручную прямо на карте;

-   *Захват кривой из объекта* ![](images/Снимок%20экрана%202025-03-12%20в%2014.20.03.png){width="36"} - использование уже существующей линии из векторного слоя.

В первом случае необходимо просто нарисовать нужную вам линию профиля (она может быть отрисована как любая ломаная линия), по которой будет происходить построения.

![](images/Снимок%20экрана%202025-03-12%20в%2014.22.05.png){fig-align="center"}

При перемещении курсора по графику или линии профиля вы увидите перемещающуюся точку, показывающую конкретное положение.

```{=html}
<iframe width="800" height="400" src="images/Запись экрана 2025-03-12 в 14.24.11.mp4" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
```

Функция прилипания ![](images/Снимок%20экрана%202025-03-12%20в%2014.49.40.png){width="38" height="34"} как и при обычной векторизации позволяет использовать другие объекты в качестве исходных.

Полученный профиль вы можете сохранить в виде картинки графика или файла pdf ![](images/Снимок%20экрана%202025-03-12%20в%2014.51.16.png){width="67" height="35"} или же результаты могут быть сохранены в виде линии профиля (в двумерном и трехмерном видах) для последующего использования в ГИС или CAD программах и в виде таблицы значений высот вдоль профиля.

![](images/Снимок%20экрана%202025-03-12%20в%2014.51.32.png){fig-align="center" width="400"}

# Выявление форм рельефа

::: callout-important
Для нижеописанных расчетов используются инструменты программы SAGA. Как и QGIS это бесплатное программное обеспечение.

Ее вы можете установить себе на компьютер как отдельное приложение, скачав, например, по [ссылке](https://sourceforge.net/projects/saga-gis/). Возможно она у вас уже установлена вместе с QGIS (если вы устанавливали его пакетно).

Либо вы можете воспользоваться этими инструментами напрямую из QGIS. Для этого необходимо установить модуль *Processing Saga NextGen Provider*, после чего скачать программу для своей операционной системы по [ссылке](https://sourceforge.net/projects/saga-gis/) и разместить на своем компьютере в папке в надежном месте. Далее в настройках программы QGIS вам нужно прописать, где же хранится SAGA.[^11]

![](images/Снимок%20экрана%202025-03-14%20в%2011.33.30.png){fig-align="center"}

Установку для Windows можно посмотреть в видео по [ссылке](https://www.youtube.com/watch?v=VKdaripCups&ab_channel=cornell-gis).
:::

[^11]: <https://gis.stackexchange.com/questions/468320/installing-saga-next-gen-binaries-in-qgis-on-a-mac>

## Расчет структурных линий рельефа

Выделение структурны линий рельефа можно осуществить с использованием инструмента *Surface specific points* в наборе инструментов SAGA.

![](images/Снимок%20экрана%202025-03-14%20в%2014.15.41.png){fig-align="center"}

Чем большее значение порога вы установите, тем более крупные структурные линии будут выделяться.

![](images/image_2025-03-14_14-16-59.png){fig-align="center"}

## Определение выпуклых и вогнутых форм рельеф

Формы рельефа определяются на основе *индекса топографического положения (Topographic position index - TPI)*. Этот индекс позволяет классифицировать формы рельефа по высоте конкретного пикселя относительно соседей: если он ниже, то значение индекса будет отрицательным и он будет отнесен к вогнутой форме рельефа; если он выше соседей, то индекс будет больше нуля и этот пиксель будет классифицирован как выпуклая часть рельефа.

![Источник: https://landscapearchaeology.org/2019/tpi/](images/TPI_diagram.png){fig-align="center"}

![Источник: https://chuck-sutherland.blogspot.com/2019/10/topographic-position-index-tpi-as.html](images/48880191738_a91f4757a2_c.jpg){fig-align="center"}

### Расчет стандартными инструментами

Индекс топографического положения может быть рассчитан с использованием стандартного инструмента из строки меню: *Растр* $\longrightarrow$ *Анализ* $\longrightarrow$ *Индекс топографического положения (TPI)*.

![](images/Снимок%20экрана%202025-03-14%20в%2011.41.05.png){fig-align="center"}

Здесь достаточно указать растр, используемый для расчета и необходимость обработки краев: так как расчеты осуществляются с использованием движущегося окна вокруг каждого из пикселей, то края обычно не обрабатываются, так как эти пиксели не имеют достаточного числа соседей.

![](images/Снимок%20экрана%202025-03-14%20в%2011.48.52.png){fig-align="center"}

Полученный результат вы увидите на растре (на картинке ниже взята цветная шкала, по умолчанию вы получите изображение в оттенках серого).

![](images/Снимок%20экрана%202025-03-14%20в%2011.54.09.png){fig-align="center" width="647"}

В примере превалируют либо ровные области, либо небольшие выпуклости и вогнутости рельефа.

Однако такой результат может быть еще связан с небольшим окном для расчетов. Другие варианты расчета дают большую гибкость и позволяют четче выделять формы рельефа.

### Расчет с использованием функций SAGA

В наборе инструментов SAGA есть целая группа, предназначенная специально для морфометрического анализа рельефа - *Terrain analysis - Morphometry*, среди которых в том числе есть и расчет индекса топографического положения - *Topographic position index (tpi)*.

Использование этого инструмента в отличие от стандартного дает больше контроля пользователю, так как здесь можно выбирать размер ячеек для анализа, а также задавать весовые значения.

![](images/Снимок%20экрана%202025-03-14%20в%2011.56.44.png){fig-align="center"}

За счет большей адаптивности этого инструмента получается более легко и наглядно интерпретируемый результат.

![](images/image_2025-03-14_12-16-51.png){fig-align="center"}

::: callout-note
Также есть инструмент для классификации форм рельефа на основе индекса топографического положения - *Tpi based land form classification*.

Но, к сожелению, у меня расчет этим инструментов так и не окончился успехом.
:::

### Расчет с использованием модуля Terrain shading

:::: callout-important
Для расчетов топографического индекса положения необходимо, чтобы данные были в прямоугольной системе координат, поэтому растр с цифровой моделью рельефа необходимо перепроецировать: *Растр* $\longrightarrow$ *Проекции* $\longrightarrow$ *Деформация (перепроецирование)*.

![](images/Снимок%20экрана%202025-03-14%20в%2012.40.23.png){fig-align="center"}

::: callout-tip
Наиболее оптимальным является перепроецирование в плоскую прямоугольную систему координат из группы систем координат UTM. Для расчета нужной вам зоны системы координат можно воспользоваться сервисом по ссылке <https://www.latlong.net/lat-long-utm.html>
:::

![](images/Снимок%20экрана%202025-03-14%20в%2012.43.39.png){fig-align="center"}
::::

Для расчета индекса топографического положения воспользуемся инструментом *Topographic position (TPI)*.

![](images/Снимок%20экрана%202025-03-14%20в%2012.45.22.png){fig-align="center"}

Так же как и для инструментов SAGA вы можете здесь настроить возможность использования весов и радиус обработки.

![](images/Снимок%20экрана%202025-03-14%20в%2012.48.19.png){fig-align="center"}

::: callout-tip
Чем больший радиус вы установите, тем более крупные формы рельефа будут обнаруживаться.
:::

Недостатком полученного результата будет являться добавление дополнительных пикселей вдоль границ исходного растра со значениями, лежащими за пределами корректного диапазона индекса.

![](images/Снимок%20экрана%202025-03-14%20в%2012.52.26.png){fig-align="center"}

Однако это можно исправить настройкой стиля слоя, в которых можно указать минимальные и максимальные значения растра и исключить все, что не попадает в пределы диапазона.

![](images/Снимок%20экрана%202025-03-14%20в%2012.52.02.png){fig-align="center"}

Полученный результат хоть и будет содержать небольшую рамку, но уже не будет так сильно искажать интерпретацию.

![](images/Снимок%20экрана%202025-03-14%20в%2012.56.12.png){fig-align="center"}

Также полученный растр можно обрезать по маске.

::: callout-tip
Как показали несколько попыток расчета можно попробовать осуществить его для растра в географической системе координат, так вы не получите дополнительных полей по краям.

![](images/Снимок%20экрана%202025-03-14%20в%2012.50.19.png){fig-align="center"}
:::

::: callout-tip
Дополнительно вы можете наложить на свой растр с индексом топографического положения горизонтали, чтобы понять, действительно ли рельеф изменяется согласно полученным значениям.

![](images/Снимок%20экрана%202025-03-14%20в%2014.14.08.png){fig-align="center"}
:::

# Классификация форм рельефа

Алгоритм классификации форм рельефа в наборе инструментов SAGA основан на статье **Iwahashi, J. & Pike, R.J. (2007):** Automated classifications of topography from DEMs by an unsupervised nested-means algorithm and a three-part geometric signature.

В соответствии с предложенными авторами алгоритмом вся территория автоматически делится на категории по форме поверхности с использованием - градиента склона, локальной выпуклости и текстуре поверхности.

![](images/Снимок%20экрана%202025-03-14%20в%2014.26.11.png){fig-align="center"}

![](images/image_2025-03-14_14-21-53.png){fig-align="center"}

# Определение открытых и закрытых элементов рельефа

Для расчета открытых и закрытых форм рельефа в комплекте инструментов SAGA есть *Topographic openness*, которая позволяет рассчитать два растра: с открытыми формами и закрытыми соответственно.

![](images/image_2025-03-14_13-13-14.png){fig-align="center"}

![Открытые выпуклые формы рельефа](images/image_2025-03-14_13-13-52.png){fig-align="center"}

![Закрытые формы рельефа](images/image_2025-03-14_13-14-15.png){fig-align="center"}

# Анализ видимости

Анализ видимости здесь рассмотрен на основе модуля [*Visibility analysis*](https://landscapearchaeology.org/qgis-visibility-analysis/).

## Индекс видимости[^12]

[^12]: **Visibility index (total viewshed) for QGIS : finally there! -** <https://landscapearchaeology.org/2020/visibility-index/>

**Индекс видимости** - это метрика, показывающая поле зрения для любой точки ланшафта.

Индекс видимости рассчитывается как отношение положительных визуальных связей: 1,0 или 100% означает, что точка видна со всех своих соседей.

В качестве исходных данных здесь задается только цифровая модель рельефа, остальные параметры устанавливаются непосредственно при расчете:

-   радиус анализа - насколько далеко необходимо осуществлять видимость;

-   высота наблюдателя, то есть высота, с которой осуществляется обзор относительно поверхности земли;

-   sample - количество линий обзора;

-   направление - расчет с точки зрения наблюдения за ландшафтом или как точек обзора.

![](images/Снимок%20экрана%202025-03-14%20в%2013.57.35.png){fig-align="center"}

![Индекс видимости](images/Снимок%20экрана%202025-03-14%20в%2013.54.10.png){fig-align="center"}

## Расчет бассейнов видимости[^13]

[^13]: **Viewshed analysis in QGIS 3: a tutorial -** <https://landscapearchaeology.org/2020/viewshed-tutorial/>

Результатом расчета бассейна видимости, как правило, является бинарный растр со значениями 1 (пиксель видим с точки обзора) или 0 (пиксель не виден с точки обзора).

Если точек обзора много, то их бассейны видимости будут суммироваться при наложении.

На первом этапе необходимо создать точки обзора из имеющегося точечного слоя - *Create viewpoints*.

![](images/Снимок%20экрана%202025-03-14%20в%2015.20.26.png){fig-align="center"}

В качестве исходных данных в расчет передаются точечный слой, для которого будут осуществляться расчеты, и цифровая модель рельефа.

::: callout-important
Важно, что слой с точками обзора и цифровая модель рельефа должны быть в одной системе координат.
:::

Обязательными параметрами являются:

-   радиус анализа (в метрах) - максимальное расстояние видимости;

-   высота наблюдателя, то есть высота, с которой ведется обзор (здесь может быть задана как высота среднего роста человека, так и высота здания, если обзор будет осуществляться с него);

-   целевая высота - значение высоты, которое добавляется ко всем участкам местности, проверяемым на видимость из точки наблюдателя.

В результате вы получите точечный слой из объектов, которые могут использоваться как точки обзора, так как имеют свою собственную высоту.

Далее можно рассчитать бассейны видимости с помощью инструмента *Viewshed*.

![](images/Снимок%20экрана%202025-03-14%20в%2015.26.55.png){fig-align="center"}

Инструмент позволяет рассчитать три вида бассейнов видимости:

-   бинарный - видно/не видно (1/0);

-   расположение ниже горизонта - высота, на которую должно подняться каждое место, чтобы стать видимым;

-   горизонт - внешний край бассейна видимости.

![](images/Снимок%20экрана%202025-03-14%20в%2015.26.19.png){fig-align="center"}

При использовании двух точек обзора были получены зоны видимости, показанные на рисунке ниже.

![](images/Снимок%20экрана%202025-03-14%20в%2015.30.39.png){fig-align="center"}

Для отображения зон видимости поверх остального рельефа можно настроить стиль полученного слоя как *Палитра/Уникальные значения* и сделать нулевые значения прозрачными.

![](images/Снимок%20экрана%202025-03-14%20в%2015.32.54.png){fig-align="center"}

В результате на карте у вас будут отображаться только те зоны, которые видны с ваших точек обзора, поверх остальных слоев.

![](images/Снимок%20экрана%202025-03-14%20в%2015.34.42.png){fig-align="center"}

::: callout-tip
Для построения зон видимости в условиях городской застройки можно воспользоваться библиотекой для python - [ObjectNat](https://github.com/DDonnyy/ObjectNat/blob/master/README_ru.md).

![](images/367514482-2927ac86-01e8-4b0e-9ea8-72ad81c13cf5.png){fig-align="center"}

![](images/367514471-b5b0d4b3-a02f-4ade-8772-475703cd6435.jpg){fig-align="center"}
:::

:::: callout-tip
В том случае, если у вас есть цифровая модель поверхности со всеми зданиями для исследуемой территории, можно воспользоваться модулем *Visibility analysis* и вот этим [туториалом](https://medium.com/data-science/running-visibility-analysis-in-qgis-d8fbdd8b02c5).

![](images/1_L7P9M0puu8v0sUIaO_foGg.webp){fig-align="center"}

![](images/1_0xSmzCifZ3KmiErSgmIieQ.webp){fig-align="center"}

::: callout-tip
Для добавления зданий к цифровой модели рельефа можно использовать модуль [UMEP](https://umep-docs.readthedocs.io/projects/tutorial/en/latest/Tutorials/DSMGenerator.html).
:::
::::

# Расчет высоты расположения зданий

В том случае, если необходимо рассчитать значение высот в пределах объектов векторного слоя (административных районов, например) или значение высот, на которых расположены здания, можно воспользоваться стандартным инструментом *Зональная статистика*.

Этот инструмент позволяет рассчитать значение какой-либо из статистик растрового слоя в пределах векторных объектов.

::: callout-tip
Этот же инструмент может использоваться, например, для вычисления средних значений вегетационного индекса в пределах кварталов.
:::

В качестве исходных данных была использована цифровая модель рельефа FABDEM для территории Москвы и векторный слой со зданиями, скачанными из OSM.

![](images/Снимок%20экрана%202025-03-14%20в%2016.00.10.png){fig-align="center"}

![](images/Снимок%20экрана%202025-03-14%20в%2015.58.21.png){fig-align="center"}

Доступные для расчета статистические показатели приведены на рисунке ниже. Вы можете использовать один из них или любой набор из нескольких.

![](images/Снимок%20экрана%202025-03-14%20в%2015.58.35.png){fig-align="center"}

По результатам расчета вы получите векторный слой с объектами из исходного слоя, но в их атрибутивную таблицу будет добавлено новое поле с полученными значениями показателя (или несколько полей, если вы рассчитывали несколько показателей).

![](images/Снимок%20экрана%202025-03-14%20в%2016.06.08.png){fig-align="center"}

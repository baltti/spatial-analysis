---
title: "Анализ рельефа"
format: html
---

# Цифровая модель рельефа

Цифровая модель рельефа (ЦМР) — это растровое представление непрерывной поверхности, обычно относящееся к поверхности Земли[^1].

[^1]: Что такое цифровые модели рельефа (ЦМР) - <https://pro.arcgis.com/ru/pro-app/latest/tool-reference/spatial-analyst/exploring-digital-elevation-models.htm>

::: callout-important
Различают цифровую модель рельефа и цифровую модель местности. Разница между ними состоит в том, что цифровая модель местности включает в себя все объекты, расположенные на поверхности, тогда как цифровая модель рельефа - это только поверхность земли без растительности и строений.

![Источник: https://innoter.com/articles/matritsa-vysot/](images/matrix_height_04.webp){fig-align="center"}
:::

Цифровые модели рельефа, как правило, строят либо по результатам интерполяции, либо на основе открытых данных.

Самым распространенным источником данных о рельефе является цифровая модель рельефа SRTM (shuttle radar topographic mission). Эта цифровая модель была получена в 2000 году на основе спутниковой радарной съемки. Она охватывает планету между 54 градусами южной широты и 60 градусами северной широты. Подробнее на русском можно почитать про нее [здесь](https://gis-lab.info/qa/srtm.html)

Скачать данные SRTM можно на сайте Геологической службы США (<https://earthexplorer.usgs.gov/>) или с помощью плагина [SRTM downloader](https://plugins.qgis.org/plugins/SRTM-Downloader/)[^2].

[^2]: **Плагин SRTM-Downloader — загрузка SRTM с сервера прямо в QGIS** <https://cartetika.ru/tpost/98m7ngx971-plagin-srtm-downloader-zagruzka-srtm-s-s>

::: callout-warning
Для использования модуля и загрузки данных напрямую из QGIS все равно необходимы реквизиты аккаунта на сайте USGS.
:::

::: callout-warning
Значительным недостатком SRTM является ее ограниченный пространственный охват, из-за которого значительная часть нашей страны не покрыта этой цифровой моделью рельефа.
:::

Для примера и выполнения работы были скачаны данные для окрестностей Эльбруса (файл [dem_elbrus.tiff](https://drive.google.com/file/d/1FYFUxG7s_T-bEZV4Azu-G7FVfVIDZ86_/view?usp=sharing)).

Из SRTM выгружается сразу целая 1-градусная трапеция (фрагмент 1 градус по широте и 1 градус по долготе), в этом случае трапеция была обрезана до более маленького фрагмента (вообще не очень рекомендую работать с большими растрами, охватывающими сразу градус и более по долготе и широте).

::: callout-note
Более современной и точной цифровой моделью рельефа является модель FABDEM, к тому же она действительно глобальная и охватывает всю территорию земного шара.

Немного почитать о ней на русском можно по [ссылке](https://cartetika.ru/tpost/0l2nfnr1l1-tsifrovaya-model-relefa-fabdem).

Самое главное ее отличие от более ранних моделей в наличии процессинга и удалении из нее объектов, расположенных на поверхности Земли.

![Источник: https://iopscience.iop.org/article/10.1088/1748-9326/ac4d4f](images/erlac4d4ff1_hr.jpg){fig-align="center"}

Сама модель является открытой и данные можно скачать по ссылке из репозитория - <https://data.bris.ac.uk/data/dataset/s5hqmjcdj8yo2ibzi9b4ew3sn>

Все данные организованы в архивы, которые включают в себя охват 10 широты на 10 градусов долготы. Растровые данные внутри архивов - это одноградусные трапеции (как и в SRTM).

Для того, чтобы понять, какой именно архив и файл из него нужен вам на исследуемую территорию, можно скачать файл ***FABDEM_v1-2_tiles.geojson*** и открыть его либо в QGIS, либо с использованием сервиса geojson.io. Прямоугольники в этом файле показывают одноградусные трапеции, а в их атрибутах указано название архива и файла.

![](images/Снимок%20экрана%202025-03-13%20в%2016.21.33.png){fig-align="center"}
:::

::: callout-note
Еще более современная и точная модель рельефа, основанная на ансамблевом расчете обобщенной модели с использованием распространенных открытых цифровых моделей рельефа - Global Ensemble Digital Terrain Model 30m (GEDTM30) (<https://zenodo.org/records/14900181)> глобальная цифровая модель рельефа (DTM) в виде двух GeoTIFF файлов оптимизированных для облачной работы (cloud GeoTIFF) общим объёмом чуть менее 39 гигабайт.

![](images/photo_2025-04-28_12-23-16.jpg){fig-align="center"}
:::

В каждой ячейке исходного растрового изображения содержится значение высоты.

Добавление растрового слоя осуществляется через строку меню *Слой* $\longrightarrow$ *Добавить слой* $\longrightarrow$ *Добавить растровый слой*.

![](images/191.png)

После открытия файла его лучше сразу перепроецировать на лету в EPSG:3857.

::: callout-tip
Перепроецирование на лету не будет изменять систему координат слоя, а только изменит систему координат проекта и то, как ваша карта будет отображаться на экране.

Перепроецирование на лету может быть выполнено с использованием кнопки ![](images/Снимок%20экрана%202025-03-03%20в%2017.37.13.png){width="200"} в правом нижнем углу основного окна программы.
:::

В результате будет открыто изображение рельефа в оттенках серого цвета.

![](images/192.PNG)

Это изображение можно сделать цветным, для этого нужно открыть свойства слоя. В настройках стиля нужно выбрать тип изображения **Одноканальное псевдоцветное**.

Одноканальное здесь очевидно потому, что изображение не поделено на каналы и существует только в одном.

![](images/193.PNG)

![](images/194.PNG)

Градиент можно также создать самостоятельно с помощью редактора градиентов.

![](images/195.PNG)

![](images/196.PNG)

Или выбрать из готового каталога градиентов. Для этого при создании нового градиента нужно выбрать каталог **cpt-city**.

![](images/198.PNG)

Далее в каталоге слева выбрать тип градиента Topography и подобрать нужный градиент (можно взять elevation или с3t3).

![](images/199.PNG)

![Градиент c3t3](images/200.PNG)

# Теневой рельеф[^3]

[^3]: <https://docs.qgis.org/3.16/en/docs/user_manual/processing_algs/qgis/rasterterrainanalysis.html?highlight=relief%20analysis#hillshade>

## Расчет теневого рельефа

Для более наглядного отображения рельефа на карте рассчитывается теневой рельеф, который строится с использованием позиции источника направленного света, или теневая отмывка.

![](images/201.PNG)

В данном случае одним из самых важных параметров является **Масштабирование по Z -** этот параметр позволяет соотнести между собой единицы измерения плановых координат и высот. В нашем случае высоты в ячейках растра приведены в метрах, а координаты - в градусах., кроме того, стоит учитывать, что в географических системах координат искажение зависит от долготы.

С этим можно справиться двумя способами - перепроецировать растра в прямоугольную систему координат или задать масштабирование по Z (Z-factor). Фактически с помощью этого коэффициента мы переходим от градусов к метрам. Так как у нас окрестности Эльбруса, то можно воспользоваться значением коэффициента для 40 градусов долготы - 0.00001171.[^4]

[^4]: <https://www.esri.com/arcgis-blog/products/product/imagery/setting-the-z-factor-parameter-correctly/>

Азимут и вертикальный угол задают положение источника света.

![Теневой рельеф (теневая отмывка)](images/202.PNG)

Этот теневой рельеф можно использовать, чтобы добавить дополнительный объем подложке (предварительно нужно добавить) или исходному рельефу растра. Для этого нужно открыть свойства слоя с теневым рельефом и изменить режим смешивания на Добавление, Осветление или Затемнение (также можно поэкспериментировать с настройками яркости и контрастности).

![](images/203.PNG)

![](images/204.PNG)

![](images/205.PNG)

![](images/206.PNG)

::: callout-tip
Также можно воспользоваться функцией Цветной рельеф, которая позволяет создавать классы автоматически и задавать им цвет.

![](images/209.PNG)

![](images/210.PNG)

С использованием такого растра может быть построена трехмерная поверхность, отображающая рельеф местности, а также выполнен ряд вычислений для морфометрического анализа рельефа.

![](images/197.PNG)

Все растровые операции здесь осуществляются за счет разности значений между ячейками.
:::

## Настройка теневого рельефа как стиля растрового слоя

Рассчитывать теневой рельеф и сохранять его в отдельный слой не обязательно, вы можете просто выбрать его как тип стиля для растрового слоя в настройках свойств.

![](images/Снимок%20экрана%202025-03-13%20в%2016.31.31.png){fig-align="center"}

Полученный теневой рельеф после настройки будет отображен на карте.

![](images/Снимок%20экрана%202025-03-13%20в%2016.32.40.png){fig-align="center"}

::: callout-caution
При создании теневого рельефа с использованием настроек стиля растрового слоя на карте могут появляться артефакты - небольшая "рябь" в картинке.

![](images/Снимок%20экрана%202025-03-13%20в%2016.33.35.png){fig-align="center"}
:::

## Использование модуля Terrain shading

Более художественных результатов при создании теневого рельефа позволяет добиться модуль [Terrain shading](https://plugins.qgis.org/plugins/TerrainShading/).

Чуть подробнее про его функции можно почитать в [блоге разработчика](https://landscapearchaeology.org/qgis-terrain-shading/).

Установка модуля осуществляется стандартно (*Модули* $\longrightarrow$ *Управление модулями*). После установки модуль должен появиться у вас в панели Инструменты анализа.

![](images/Снимок%20экрана%202025-03-13%20в%2016.47.37.png){fig-align="center" width="600"}

Модуль содержит сразу три функции, которые позволяют строить теневую отмывку:

-   *Hillshade (terrain shading)* - аналогичен стандартному построению теневого рельефа;

![Результат расчета Hillshade](images/Снимок%20экрана%202025-03-13%20в%2016.52.57.png){fig-align="center"}

-   *Shadow depth* - инструмент для генерации теней;

![Результат расчета Shadow depth](images/Снимок%20экрана%202025-03-13%20в%2016.53.46.png){fig-align="center"}

-   *Toposhade* - комбинация теневого рельефа и индекса топографического положения (о нем будет еще чуть дальше), который показывает выпуклость и вогнутость рельефа. Такая комбинация позволяет добиться более выраженной карты теневого рельефа.

![Результат расчета Toposhade](images/Снимок%20экрана%202025-03-13%20в%2016.54.34.png){fig-align="center"}

::: callout-tip
Полученные новые растры можно комбинировать друг с другом и другими слоями для получения более красивого результата.

![Shadow depth и Hillshade (для обоих установлен режим смешивания Затемнение) в сочетании с подложкой 2GIS](images/Снимок%20экрана%202025-03-13%20в%2016.55.57.png){fig-align="center"}
:::

# Расчет параметров рельефа

## Крутизна склонов[^5]

[^5]: Документация функции <https://docs.qgis.org/3.16/en/docs/user_manual/processing_algs/qgis/rasterterrainanalysis.html?highlight=relief%20analysis#slope>

Расчет крутизны склонов или их уклона и экспозиции осуществляется на основе производных первого порядка.

![Определение основных геоморфометрических параметров по Zevenbergen, Thorne (1987). Источник: https://gis-lab.info/qa/geomorphometric-parameters-theory.html](images/800px-Geomorpho_theory_03.png){fig-align="center"}

### Расчет крутизны склонов

Рассчитаем крутизну склонов - угол наклона каждого склона в градусах.

![](images/207.PNG)

![](images/208.PNG)

### Выделение территорий пригодных для строительства с учетом уклона

Для того, чтобы выделить области пригодные для строительства, воспользуемся переклассификацией растра.

При переклассификации будем рассматривать территории с уклоном менее 10 %.

Так как уклон был рассчитан в градусах, а параметр пригодности для строительства задан в процентах, то пересчитаем этот параметр в градусы по формуле:

$$
Slope_{degree}=arctg(\dfrac{Slope_{percent}}{100})
$$

Полученное значение пригодности - 6 градусов.

Переклассифицируем растр и выделим области пригодные или непригодные для строительства.

![](images/Снимок%20экрана%202025-03-12%20в%2012.12.49.png){fig-align="center"}

::: callout-important
Обратите внимание, что здесь в дополнительных параметрах можно указать, как именно будут задаваться границы интервалов, то есть будут ли включаться в них нижний или верхний предел интервала.

![](images/Снимок%20экрана%202025-03-12%20в%2012.18.05.png){fig-align="center" width="600"}
:::

В таблице реклассификации следует ввести границы интервалов и соответствующее им значение (эти значения должны быть целочисленными.

![](images/Снимок%20экрана%202025-03-12%20в%2012.12.25.png){fig-align="center"}

В результате будет получен дискретный растр с двумя значениями (или с тем количеством значений классов, которое вы указали в таблице реклассификации.

![](images/Снимок%20экрана%202025-03-12%20в%2012.21.50.png){fig-align="center"}

## Экспозиция склонов[^6]

[^6]: Экспозиция - <https://docs.qgis.org/3.16/en/docs/user_manual/processing_algs/qgis/rasterterrainanalysis.html?highlight=relief%20analysis#aspect>

*Экспозиция поверхности – угол по часовой стрелке между определенным направлением (как правило, на север) и проекцией уклона на горизонтальную плоскость; фиксирует направление (азимут) максимального уклона (градиента) земной поверхности*[^7].

[^7]: Основные геоморфометрические параметры: теория - [https://gis-lab.info/qa/geomorphometric-parameters-theory.html#%D0%9E%D1%81%D0%BD%D0%BE%D0%B2%D0%BD%D1%8B%D0%B5\_%D0%B3%D0%B5%D0%BE%D0%BC%D0%BE%D1%80%D1%84%D0%BE%D0%BC%D0%B5%D1%82%D1%80%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B5\_%D0%BF%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80%D1%8B](https://gis-lab.info/qa/geomorphometric-parameters-theory.html#%D0%9E%D1%81%D0%BD%D0%BE%D0%B2%D0%BD%D1%8B%D0%B5_%D0%B3%D0%B5%D0%BE%D0%BC%D0%BE%D1%80%D1%84%D0%BE%D0%BC%D0%B5%D1%82%D1%80%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B5_%D0%BF%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80%D1%8B,){.uri}

Эта функция позволяет определить ориентацию склонов по сторонам света.

![](images/211.PNG)

![](images/212.PNG)

## Расчет неоднородности рельефа[^8]

[^8]: <https://docs.qgis.org/3.16/en/docs/user_manual/processing_algs/qgis/rasterterrainanalysis.html?highlight=relief%20analysis#ruggedness-index>

Также по растру с данными о рельефе может быть рассчитана неоднородность рельефа.

Этот показатель рассчитывается на основе разности значений между пикселями в сетке 3 на 3. Таким образом, каждый полученный пиксель содержит разницу между центральным пикселем и 8 его окружащими.

![Riley et al (1999) “A Terrain ruggedness Index That Quantifies Topographic heterogeneity”[^9]](images/Снимок%20экрана%202025-03-14%20в%2014.09.56.png){fig-align="center"}

[^9]: <https://download.osgeo.org/qgis/doc/reference-docs/Terrain_Ruggedness_Index.pdf>

[^10]: <https://download.osgeo.org/qgis/doc/reference-docs/Terrain_Ruggedness_Index.pdf>

![](images/213.PNG)

![](images/214.PNG)

# Построение трехмерной поверхности

Также QGIS поддреживает отображение трехмерных поверхностей. Для этого нужно просто в строке меню выбрать **Вид - Новая 3D карта**.

![](images/215.png)

После чего в окне программы появится окно трехмерной карты (перемещение по карте левой кнопкой мыши, поворот и наклон - колесико, приближение - правая кнопка мыши).

![](images/216.PNG)

Сразу после открытия нового окна поверхность все еще является плоской, потому что не задано на основе чего строить трехмерную поверхность.

В окне трехмерной карты нужно нажать кнопку **Настройки** (в панели значков крайняя справа) и в открывшемся окне настроек выбрать тип **DEM (raster layer)**, **высота** (растровый слой с высотами) и **вертикальный масштаб** (здесь лучше всзять что-то от 1 до 5, чтобы поверхность была повыразительнее).

Дополнительно можно добавить **Terrain shading** (фактически теневая отмывка) и подкорректировать **tile resolution** (чем больше, тем более подробным будет рельеф), и **skirt height** (если правильно нашла - высота подставки под саму поверхность).

![](images/217.PNG)

После чего в окне будет отображена трехмерная поверхность.

![](images/218.PNG)

# Создание горизонталей

Из растра со значениями высот могут быть извлечены горизонтали

![](images/219.png)

Расстояние между изолиниями - это фактически высота сечения рельефа, то есть через сколько мы будем проводить горизонтали.

![](images/220.PNG)

Полученные изолинии

![](images/221.PNG)

Настроим горизонтали таким образом, чтобы каждая пятая была утолщенной, добавим подписи и настроим их так, чтобы они были "головой вверх".

Начнем с настройки толщины линий. Для этого в свойствах слоя выберем настройку толщины в зависимости от выражения.

![](images/222.png)

Далее пропишем логическое выражение: **if("ELEV"%500=0,0.7,0.3)**. В этом выражении перед запятой прописано условие - высота горизонтали делится на 500 без остатка, потом толщина линии, если условие выполняется, и толщина, если условие не выполняется.

![](images/223.PNG)

Результат

![](images/224.PNG)

Добавим подписи.

![](images/225.PNG)

Но при таком добавлении подписей, будут подписаны все горизонтали, а мы хотим подписать только утолщенные. Для этого нужно прописать выражение, подобное тому, что мы писали выше: **if("ELEV"%500=0,"ELEV","").**

![](images/226.PNG)

Добавим белую обводку подписям, чтобы они не сливались с горизонталями

![](images/227.PNG)

Сделаем так, чтобы они размещались на линии и изгибались в соответствии с ней.

![](images/228.PNG)

И настроим подписи так, чтобы все они смотрели головой в сторону увеличения высоты.

![](images/229.PNG)

![](images/230.PNG)

В результате получим горизонтали, где каждая пятая будет утолщена и подписана головой в сторону увеличения.

![](images/231.PNG)

# Построение профиля местности

В актуальных версиях программы построения профиля местности по цифровой модели рельефа является функцией по умолчанию. Этот инструмент можно открыть из строки меню *Вид* $\longrightarrow$ *Профиль высот*.

![](images/Снимок%20экрана%202025-03-12%20в%2013.07.28.png){fig-align="center" width="600"}

Окно профиля высот открывается в нижней части интерфейса. Ваша цифровая модель рельефа (если растр с ней загружен в проект должна автоматически добавиться в левую часть окна построения профиля.

![](images/Снимок%20экрана%202025-03-12%20в%2014.14.16.png){fig-align="center"}

::: callout-important
Если ваша цифровая модель рельефа не добавилась в высотный профиль автоматически, то вам нужно проверить ее настройки.

В свойствах слоя (открываются двойным кликом или кликом правой кнопки мыши и выбором пункта *Свойства* из открывшегося контекстного меню) необходимо найти пункт *Высота* и поставить галочку напротив настройки *"Представляет собой данные высоты"*.

![](images/Снимок%20экрана%202025-03-12%20в%2014.16.24.png){fig-align="center"}

После этого ваша цифровая модель будет автоматически добавлена в окно высотного профиля.
:::

Построение профиля может происходить двумя способами:

-   *Захват кривой* ![](images/Снимок%20экрана%202025-03-12%20в%2014.19.51.png){width="35" height="32"} - отрисовка линии профиля осуществляется вручную прямо на карте;

-   *Захват кривой из объекта* ![](images/Снимок%20экрана%202025-03-12%20в%2014.20.03.png){width="36"} - использование уже существующей линии из векторного слоя.

В первом случае необходимо просто нарисовать нужную вам линию профиля (она может быть отрисована как любая ломаная линия), по которой будет происходить построения.

![](images/Снимок%20экрана%202025-03-12%20в%2014.22.05.png){fig-align="center"}

При перемещении курсора по графику или линии профиля вы увидите перемещающуюся точку, показывающую конкретное положение.

```{=html}
<iframe width="800" height="400" src="images/Запись экрана 2025-03-12 в 14.24.11.mp4" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
```

Функция прилипания ![](images/Снимок%20экрана%202025-03-12%20в%2014.49.40.png){width="38" height="34"} как и при обычной векторизации позволяет использовать другие объекты в качестве исходных.

Полученный профиль вы можете сохранить в виде картинки графика или файла pdf ![](images/Снимок%20экрана%202025-03-12%20в%2014.51.16.png){width="67" height="35"} или же результаты могут быть сохранены в виде линии профиля (в двумерном и трехмерном видах) для последующего использования в ГИС или CAD программах и в виде таблицы значений высот вдоль профиля.

![](images/Снимок%20экрана%202025-03-12%20в%2014.51.32.png){fig-align="center" width="400"}
